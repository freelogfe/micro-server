(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{426:function(e,t,n){var a=n(455),s=n(456),i=n(457);e.exports=function(e){return a(e)||s(e)||i()}},432:function(e,t,n){"use strict";n.r(t),n.d(t,"RESOURCE_TYPES",function(){return s}),n.d(t,"RESOURCE_STATUS_MAP",function(){return i}),n.d(t,"RESOURCE_STATUS",function(){return r});var a=n(2),s={json:"json",widget:"widget",image:"image",audio:"audio",markdown:"markdown",page_build:"page_build",reveal_slide:"reveal_slide",license:"license",video:"video",catalog:"catalog"},i={unknown:0,unpublished:1,published:2,freeze:3},r=[{desc:a.a.t("config.resource.states[0]"),type:"danger",status:i.unknown},{desc:a.a.t("config.resource.states[1]"),type:"warning",status:i.unpublished},{desc:a.a.t("config.resource.states[2]"),type:"success",status:i.published},{desc:a.a.t("config.resource.states[3]"),type:"danger",status:i.freeze}]},433:function(e,t,n){},442:function(e,t,n){"use strict";n.r(t),n.d(t,"COMMON_NAME_REGEXP",function(){return a});var a=/^(?!.*(\\|\/|:|\*|\?|"|<|>|\||\s|@|#|\$)).{1,60}$/},455:function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},456:function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},457:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},459:function(e,t,n){"use strict";var a=n(433);n.n(a).a},462:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fl-pagination"},[n("el-table",e._b({ref:"table",staticStyle:{width:"100%"},attrs:{"empty-text":e.emptyText},on:{"row-click":e.rowClickHandler,"selection-change":e.selectionChangeHandler}},"el-table",e.tableProps,!1),[e._t("list")],2),e._v(" "),0===e.tableProps.data.length?e._t("empty"):e._e(),e._v(" "),e.showFooter?n("div",{staticClass:"fl-pg-ft clearfix"},[e._t("footer"),e._v(" "),n("el-pagination",{staticClass:"fl-pg-info",attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],2):e._e()],2)};a._withStripped=!0;var s=n(6),i={name:"fl-pagination",props:{emptyText:{type:String,default:"暂无数据"},pagination:{type:Object,default:function(){return{pageSize:10}}},config:Object,rowClickHandler:{type:Function,default:function(){}},selectionChangeHandler:{type:Function,default:function(e){}},formatHandler:Function,showFooter:{type:Boolean,default:!0}},data:function(){return{total:8,tableProps:{data:[]},currentPage:1,pageSize:parseInt(window.sessionStorage.getItem("".concat(this.$route.fullPath,"_page_size")))||10,loading:!1}},watch:{pagination:{deep:!0,handler:function(){this.reload()}},pageSize:function(){this.reload()}},methods:{loadData:function(){if(!this.pagination.target)throw new Error("need pagination target param");var e={page:this.currentPage,pageSize:this.pageSize};return this.source=s.axios.CancelToken.source(),this.pagination.params&&Object.assign(e,this.pagination.params),this.$axios.get(this.pagination.target,{params:e,cancelToken:this.source.token}).then(function(e){if(e.data){if(0===e.data.ret&&0===e.data.errcode)return e.data.data;throw new Error(e.data.msg)}})},update:function(e){if(e&&e.dataList){this.total=e.totalItem||e.dataList.length;var t="function"==typeof this.formatHandler?this.formatHandler(e.dataList):e.dataList;this.tableProps.data=t}},reload:function(){this.currentPage=1,this.loading&&this.source&&(this.loading=!1,this.source.cancel("cancel")),this.load()},load:function(){var e=this;this.loading||(this.loading=!0,this.loadData().then(this.update.bind(this)).then(function(){e.loading=!1,window.sessionStorage.setItem("".concat(e.$route.fullPath,"_page_size"),e.pageSize)}).catch(function(t){t.message&&"cancel"===t.message||e.$error.showErrorMessage(t),e.loading=!1}))},handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e,this.load()}},mounted:function(){Object.assign(this.tableProps,this.config),this.load()}},r=(n(459),n(3)),o=Object(r.a)(i,a,[],!1,null,null,null);o.options.__file="src/components/Pagination/index.vue";t.a=o.exports},475:function(e,t,n){},476:function(e,t,n){},487:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.policies.length>0?n("el-tabs",e._l(e.policies,function(t){return n("el-tab-pane",{attrs:{label:t.policyName}},[n("div",{staticStyle:{height:"200px","overflow-y":"auto"}},[n("pre",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(t.policyText))])])])}),1):e._e(),e._v(" "),0===e.policies.length?n("div",{staticStyle:{"min-height":"200px",display:"flex","align-items":"center","justify-content":"center"}},[n("span",[e._v("暂无策略......")])]):e._e()],1)};a._withStripped=!0;var s={name:"PolicyTabs",props:{policies:{type:Array,validator:function(e){return e.every(function(e){return e.hasOwnProperty("policyId")&&e.hasOwnProperty("policyName")})},default:[]}},methods:{},mounted:function(){}},i=n(3),r=Object(i.a)(s,a,[],!1,null,"183c1c83",null);r.options.__file="src/components/PolicyTabs/index.vue";t.a=r.exports},523:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"custom-tags",staticStyle:{display:"flex","align-items":"center","flex-wrap":"wrap"}},[e._l(e.tags,function(t){return n("div",{key:t,staticClass:"user-defined-tag"},[n("el-tag",{attrs:{closable:e.isCanCURD,size:"small","disable-transitions":!1},on:{close:function(n){return e.handleClose(t)}}},[n("span",{staticStyle:{color:"#666"}},[e._v(e._s(t))])])],1)}),e._v(" "),e.inputVisible?n("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"mini"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):e._e(),e._v(" "),e.inputVisible?e._e():n("i",{staticClass:"el-icon-plus",staticStyle:{"font-size":"12px",color:"#666","background-color":"#f1f1f1","border-radius":"50%",padding:"5px",cursor:"pointer","margin-bottom":"10px"},on:{click:e.showInput}})],2)};a._withStripped=!0;var s=n(426),i=n.n(s),r=n(442),o={name:"freelog-tags",data:function(){return{tags:[],inputVisible:!1,inputValue:""}},props:{value:{type:Array,default:function(){return[]}},actionText:{type:String,default:function(){return"New Tag"}},isCanCURD:{type:Boolean,default:!0}},watch:{value:function(e){this.setCurrentValue(e)}},mounted:function(){this.setCurrentValue(this.value)},methods:{setCurrentValue:function(e){this.tags=e},handleClose:function(e){this.tags=this.tags.filter(function(t){return t!==e}),this.$emit("input",this.tags)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;if(e){if(!r.COMMON_NAME_REGEXP.test(this.inputValue))return this.$message.error('标签的名称不能包含空格和以下字符：\\ / : * ? " < > |');var t=[].concat(i()(this.tags),[e]);this.tags=Array.from(new Set(t)),this.$emit("input",this.tags)}this.inputVisible=!1,this.inputValue=""}}},l=(n(620),n(621),n(3)),c=Object(l.a)(o,a,[],!1,null,"11dff78c",null);c.options.__file="src/components/Tags/index.vue";t.a=c.exports},620:function(e,t,n){"use strict";var a=n(475);n.n(a).a},621:function(e,t,n){"use strict";var a=n(476);n.n(a).a},711:function(e,t,n){},712:function(e,t,n){},713:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"createBtnText":"创建资源","createNewReleaseText":"创建新发行","resourceListTitle":"资源列表","releaseListTitle":"发行列表","presentablesListTitle":"节点发行列表","resourceList":{"name":"资源名称","type":"资源类型","allTypes":"全部类型","history":"历史发行","status":"发行情况","updateDate":"更新时间","createDate":"创建时间","operate":"操作","querying":"查询中...","noReleases":"暂无发行","releaseBtnText":"发行","saveBtnText":"保存","detailBtnText":"详情","editBtnText":"编辑","downloadBtnText":"下载源文件","releasesCount":["等","个发行..."],"messages":["没有符合条件的资源","您还没有创建任何资源。"],"releaseStatus":["未发行","已发行","全部"]},"releaseList":{"name":"发行名称","type":"发行类型","newVersion":"最新版本","allTypes":"全部类型","view":"查看","policy":"策略","policyTpls":"节点发行策略模版","updateDate":"更新时间","createDate":"创建时间","operate":"操作","editBtnText":"编辑","createBtnText":"创建Presentable","tips":["策略已下架"],"messages":["没有符合条件的发行","您还没有创建任何发行。","您还没有收藏任何发行。您在发行市场收藏的发行之后将会出现在这里。","取消成功！"],"status":["未上线","已上线"]},"presentablesList":{"name":"节点发行名称","type":"类型","tags":"标签","onlineStatus":"在线状态","operate":"操作","saveBtnText":"保存","upgradeBtnText":"升级","editBtnText":"编辑","createBtnText":"创建Presentable"}},"en":{"createBtnText":"Create Resource","createNewReleaseText":"Create a New Release","resourceListTitle":"Resource List","releaseListTitle":"Release List","presentablesListTitle":"Presentable List","resourceList":{"name":"Resource name","type":"Resource type","allTypes":"All types","history":"Release history","status":"Release status","updateDate":"Update date","createDate":"Create date","operate":"Operate","querying":"Querying...","noReleases":"No releases","releaseBtnText":"Release","saveBtnText":"save","detailBtnText":"detail","editBtnText":"Edit","downloadBtnText":"Download resource file","releasesCount":["There are "," releases..."],"messages":["There are no resources available","You have not created any resources."],"releaseStatus":["Not release","Relased","All"]},"releaseList":{"name":"Release name","type":"Release type","newVersion":"New version","allTypes":"All types","view":"view","policy":"policy","policyTpls":"presentable policy template","updateDate":"Update date","createDate":"Create date","operate":"Operate","editBtnText":"Edit","createBtnText":"create presentable","tips":["All policies has been off the shelves"],"messages":["There are no releases available","You have not created any releases.","You haven\'t collected any releases yet. You will appear here after the release of your collection in the release market.","Cancel Successful！"],"status":["offline","online"]},"presentablesList":{"name":"name","type":"type","tags":"tags","onlineStatus":"online status","operate":"Operate","saveBtnText":"save","upgradeBtnText":"upgrade","editBtnText":"edit"}}}'),delete e.options._Ctor}},944:function(e,t,n){"use strict";var a=n(711);n.n(a).a},945:function(e,t,n){"use strict";var a=n(712);n.n(a).a},946:function(e,t,n){"use strict";var a=n(713),s=n.n(a);t.default=s.a},977:function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tool-presentables-list"},[n("div",{staticClass:"tpl-header"},[n("h3",[n("span",[e._v(e._s(e.$t("presentablesListTitle")))]),e._v(" "),n("el-select",{staticClass:"tpl-node-select",attrs:{placeholder:"请选择节点"},model:{value:e.checkedNodeId,callback:function(t){e.checkedNodeId=t},expression:"checkedNodeId"}},e._l(e.nodes,function(e){return n("el-option",{key:e.nodeId,attrs:{label:e.nodeName,value:e.nodeId}})}),1),e._v(" "),n("a",{attrs:{href:e.nodeSiteMap[e.checkedNodeId],target:"_blank"}},[e._v(" "+e._s(e.nodeSiteMap[e.checkedNodeId]))])],1),e._v(" "),n("div",{staticClass:"tpl-btn-group"},[n("el-button",{attrs:{type:"primary"},on:{click:e.refreshPresentablesList}},[e._v("刷新列表")])],1)]),e._v(" "),""!==e.checkedNodeId?[n("f-pagination",{ref:"presentableslistRef",staticClass:"presentables-list-table",attrs:{config:e.tableConfig,formatHandler:e.formatHandler,pagination:e.paginationConfig,"empty-text":e.pagenationEmptyText,selectionChangeHandler:e.handleSelectionChange}},[n("template",{slot:"list"},[n("el-table-column",{attrs:{type:"selection",width:"45"}}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("presentablesList.name")},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"tpl-item-name-box"},[n("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(t.row.releaseInfo.version))]),e._v(" "),t.row.isEdittingName?n("el-input",{attrs:{placeholder:"请输入节点发行名称"},model:{value:t.row.presentableName,callback:function(n){e.$set(t.row,"presentableName",n)},expression:"scope.row.presentableName"}}):n("div",{staticClass:"tpl-item-name",attrs:{title:t.row.presentableName}},[n("router-link",{attrs:{to:t.row._toMangeDetailLink,target:"_blank"}},[e._v(e._s(t.row.presentableName))]),e._v(" "),n("i",{staticClass:"el-icon-edit",on:{click:function(n){return e.editNameHandler(t.row)}}})],1)],1)]}}],null,!1,3686423267)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("presentablesList.type"),width:"160"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("el-dropdown",{staticClass:"tpl-types",on:{command:e.handleSelectType}},[n("span",{staticClass:"el-dropdown-link"},[e._v("\n                "+e._s(e.$t("presentablesList.type"))+" "+e._s("all"===e.selectedType?"":" "+e.selectedType)),n("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.resourceTypes,function(t){return n("el-dropdown-item",{key:t.value,attrs:{command:t.value}},[e._v(e._s(t.label))])}),1)],1)]}},{key:"default",fn:function(t){return[n("div",{staticClass:"trl-item-type"},[e._v(" "+e._s(t.row.releaseInfo.resourceType))])]}}],null,!1,1314155770)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("presentablesList.tags"),width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("tags",{attrs:{value:t.row.userDefinedTags,actionText:"新标签"},on:{input:function(n){return e.tagsChangeHandler(t.row,n)}}})]}}],null,!1,2461221517)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("presentablesList.onlineStatus"),width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":"online","inactive-value":"offline"},on:{change:function(n){return e.onlineChangeHandler(t.row)}},model:{value:t.row.lineStatus,callback:function(n){e.$set(t.row,"lineStatus",n)},expression:"scope.row.lineStatus"}})]}}],null,!1,436400629)}),e._v(" "),n("el-table-column",{attrs:{label:e.$t("presentablesList.operate"),width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"tpl-row-btns"},[n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.tapUpgradeBtn(t.row)}}},[e._v(e._s(e.$t("presentablesList.upgradeBtnText")))]),e._v(" "),t.row.isChangePresentable?n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.tapSaveBtn(t.row)}}},[e._v(e._s(e.$t("presentablesList.saveBtnText")))]):e._e()],1)]}}],null,!1,1940689228)})],1)],2)]:e._e()],2)};a._withStripped=!0;var s=n(87),i=n.n(s),r=n(86),o=n.n(r),l=n(88),c=n(462),u=n(487),p=n(523),d=n(432),f={name:"tool-presentables-list",props:{},components:{FPagination:c.a,FPolicyTabs:u.a,Tags:p.a},data:function(){var e=this.$route.query.resourceType;return{search:"",loader:null,tableConfig:{rowClassName:"presentable-row","cell-class-name":"rel-row-cell","show-header":!0},paginationConfig:{pageSize:20,reloadCount:0,target:"/v1/presentables",params:{nodeId:"",isOnline:2,resourceType:null!=e?e:void 0}},selectedType:null!=e?e:"all",checkedNodeId:"",nodeSiteMap:{},selectedPresentables:[]}},computed:o()({resourceTypes:function(){for(var e=[{label:this.$i18n.t("releaseList.allTypes"),value:"all"}],t=0,n=Object.entries(d.RESOURCE_TYPES);t<n.length;t++){var a=i()(n[t],2),s=a[0],r=a[1];e.push({label:s,value:r})}return e}},Object(l.b)({session:"session",nodes:"nodes"})),watch:{nodes:function(){this.resolveNodes()},checkedNodeId:function(){this.paginationConfig.params.nodeId=this.checkedNodeId}},mounted:function(){this.initView(),this.resolveNodes()},methods:{resolveNodes:function(){var e=this;this.nodes.length&&(this.nodes.forEach(function(t){e.nodeSiteMap[t.nodeId]="".concat(window.location.protocol,"//").concat(t.nodeDomain,".").concat(window.FreelogApp.Env.mainDomain)}),this.checkedNodeId=this.nodes[0].nodeId)},initView:function(){this.nodes&&this.nodes.length&&(this.checkedNodeId=this.nodes[0].nodeId)},formatHandler:function(e){return e&&e.length?((e=e.map(function(e){return e.isEdittingName=!1,e.isChangePresentable=!1,e.lineStatus=1==+e.isOnline?"online":"offline",e._toMangeDetailLink="/node/manager-release/".concat(e.presentableId),e})).sort(function(e,t){return+new Date(t.updateDate)-+new Date(e.updateDate)}),e):[]},refreshPresentablesList:function(){this.$refs.presentableslistRef.reload()},handleSelectType:function(e){this.selectedType=e,this.$router.push({query:{resourceType:e}}),"all"===this.selectedType?this.paginationConfig.params.resourceType=void 0:this.paginationConfig.params.resourceType=this.selectedType},handleSelectionChange:function(e){this.selectedPresentables=e},updatePresentable:function(e){var t=this,n=e.presentableName,a=e.userDefinedTags;e.releaseInfo.releaseId;return this.$services.PresentablesService.put(e.presentableId,{presentableName:n,userDefinedTags:a}).then(function(e){return e.data}).then(function(n){0===n.errcode?(t.$message.success("保存成功！"),e.isEdittingName=!1,e.isChangePresentable=!1):t.$message.error("保存失败！")})},tapSaveBtn:function(e){this.updatePresentable(e)},tapUpgradeBtn:function(e){var t=this,n=e.presentableId,a=e.releaseInfo,s=a.version,i=a.releaseId;this.$services.ReleaseService.get(i).then(function(e){return e.data}).then(function(e){var t=s;0===e.errcode&&(t=e.data.latestVersion.version);return t}).then(function(e){return t.$services.PresentablesService.put("".concat(n,"/switchPresentableVersion"),{version:e})}).then(function(e){return e.data}).then(function(e){0===e.errcode?t.$message({type:"success",message:"升级成功！"}):t.$message({type:"error",message:"升级失败！"})}).catch(this.$error.showErrorMessage)},editNameHandler:function(e){e.isEdittingName=!0,e.isChangePresentable=!0},onlineChangeHandler:function(e){var t=this,n=e.lineStatus,a=e.presentableId,s=e.presentableName,i="online"===n?1:0;return this.$services.PresentablesService.put("".concat(a,"/switchOnlineState"),{onlineState:i}).then(function(e){return e.data}).then(function(n){if(0===n.errcode){var a=1===i?"上线成功！":"下线成功！";t.$message.success("「".concat(s,"」").concat(a)),e.online=i}else{var r=1===i?"上线失败！":"下线失败！";t.$message.error("「".concat(s,"」").concat(r,":").concat(n.msg)),e.lineStatus=1===i?"offline":"online"}})},tagsChangeHandler:function(e,t){e.userDefinedTags=t,e.isChangePresentable=!0}}},h=(n(944),n(945),n(3)),g=n(946),v=Object(h.a)(f,a,[],!1,null,"47c8bca2",null);"function"==typeof g.default&&Object(g.default)(v),v.options.__file="src/views/tools/presentables-list.vue";t.default=v.exports}}]);