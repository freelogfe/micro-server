(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{427:function(e,t,s){var a=s(463),i=s(464),r=s(465);e.exports=function(e){return a(e)||i(e)||r()}},434:function(e,t,s){"use strict";s.r(t),s.d(t,"RESOURCE_TYPES",function(){return i}),s.d(t,"RESOURCE_STATUS_MAP",function(){return r}),s.d(t,"RESOURCE_STATUS",function(){return n});var a=s(1),i={json:"json",widget:"widget",image:"image",audio:"audio",markdown:"markdown",page_build:"page_build",reveal_slide:"reveal_slide",license:"license",video:"video",catalog:"catalog"},r={unknown:0,unpublished:1,published:2,freeze:3},n=[{desc:a.a.t("config.resource.states[0]"),type:"danger",status:r.unknown},{desc:a.a.t("config.resource.states[1]"),type:"warning",status:r.unpublished},{desc:a.a.t("config.resource.states[2]"),type:"success",status:r.published},{desc:a.a.t("config.resource.states[3]"),type:"danger",status:r.freeze}]},441:function(e,t,s){"use strict";s.r(t),s.d(t,"COMMON_NAME_REGEXP",function(){return a});var a=/^(?!.*(\\|\/|:|\*|\?|"|<|>|\||\s|@|#|\$)).{1,60}$/},463:function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}},464:function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},465:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},483:function(e,t,s){},655:function(e,t,s){"use strict";var a=s(483);s.n(a).a},662:function(e,t,s){},663:function(e,t,s){},664:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"noDesc":"暂无资源描述","name":"发行名称","cover":"发行封面","basicUpcast":"基础上抛","noBasicUpcast":"暂无基础上抛","scheme":"方案","version":"版本号","tips":["发行名称一旦则创建不可修改","方案中所选上抛将会成为基础上抛"],"messages":["长度必须在1–60字符之间","不能包含空格和以下字符","版本号格式有误！","发行名不能为空！","版本号不能为空！","发行创建成功！"],"createBtnText":"创建发行","cancelBtnText":"取消创建"},"en":{"noDesc":"No resource description yet","name":"Release Name","cover":"Release Cover","basicUpcast":"Basic upcast","noBasicUpcast":"There are no basic upcast yet","scheme":"scheme","version":"version","tips":["Once the release name is created, it cannot be modified","The upcast selected in the scheme will become a base upcast"],"messages":["The release name should be 4-20 characters long.","Cannot contain spaces and the following characters","The version number is in the wrong format!","The release name cannot be empty!","The version number cannot be empty!","The release was created successfully!"],"createBtnText":"Create Release","cancelBtnText":"Cancel"}}'),delete e.options._Ctor}},712:function(e,t,s){"use strict";var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"upload-cover"},[s("el-upload",{ref:"uploader",staticClass:"avatar-uploader",attrs:{accept:"image/*","with-credentials":!0,action:e.uploadPreviewImageAction,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload,multiple:e.multiple,"auto-upload":e.multiple,"on-change":e.changeImageHandler,drag:!0}},[s("a",{ref:"uploadHandleRef",on:{click:e.initData}},[e.imageUrl?s("div",{staticClass:"re-upload-mask",style:{height:e.height+"px",width:e.width+"px"}},[s("i",{staticClass:"el-icon-circle-plus",staticStyle:{color:"#fff","font-size":"40px"}}),e._v(" "),e.textVisible&&e.reUploadText?s("span",{staticStyle:{color:"#fff","font-weight":"600","font-size":"14px","padding-top":"10px"}},[e._v(e._s(e.reUploadText))]):e._e()]):e._e(),e._v(" "),e.imageUrl?s("img",{staticClass:"avatar",style:{height:e.height+"px",width:e.width+"px"},attrs:{src:e.imageUrl}}):s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center","flex-direction":"column"},style:{height:e.height+"px",width:e.width+"px"}},[s("i",{staticClass:"el-icon-circle-plus",staticStyle:{color:"#666","font-size":"40px"}}),e._v(" "),e.textVisible&&e.uploadText?s("span",{staticStyle:{color:"#666","font-weight":"600","font-size":"14px","padding-top":"10px"}},[e._v(e._s(e.uploadText))]):e._e()])])]),e._v(" "),s("el-dialog",{attrs:{"custom-class":"upload-error-dialog",visible:!!e.tmpImageUrl,width:"600","close-on-click-modal":!1,"show-close":!1}},[s("div",{staticStyle:{width:"450px",height:"450px",margin:"0 auto"}},[s("img",{ref:"tmpImage",staticStyle:{"max-width":"400px","max-height":"400px"},attrs:{src:e.tmpImageUrl}})]),e._v(" "),s("div",{staticStyle:{height:"40px"}}),e._v(" "),s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[s("el-button",{staticStyle:{color:"#999"},attrs:{type:"text"},on:{click:function(t){e.tmpImageUrl=""}}},[e._v("取消\n            ")]),e._v("\n               \n            "),s("el-button",{attrs:{type:"primary",plain:"",round:""},on:{click:e.saveCropImageHandler}},[e._v("裁剪\n            ")])],1)]),e._v(" "),s("el-dialog",{attrs:{"custom-class":"upload-error-dialog",visible:e.showDialog,width:"30%","close-on-click-modal":!1,"show-close":!1}},[s("div",{staticStyle:{height:"20px"}}),e._v(" "),s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[s("i",{staticClass:"el-icon-warning",staticStyle:{color:"#FFC000","font-size":"20px"}}),e._v(" "),s("span",{staticStyle:{"font-size":"14px",color:"#333","font-weight":"600","padding-left":"10px"}},[e._v("封面图片不能超过5M")])]),e._v(" "),s("div",{staticStyle:{height:"40px"}}),e._v(" "),s("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"center"}},[s("el-button",{staticStyle:{color:"#999"},attrs:{type:"text"},on:{click:e.hideUploadDialog}},[e._v("取消\n            ")]),e._v("\n               \n            "),s("el-button",{attrs:{type:"primary",plain:"",round:""},on:{click:e.emitUpload}},[e._v("重新选择\n            ")])],1)])],1)};a._withStripped=!0;var i,r=s(540),n=s.n(r);s(541);var o={name:"upload-cover",props:{imageUrl:String,onUploaded:Function,width:{type:Number,default:200},height:{type:Number,default:150},textVisible:{type:Boolean,default:!0},uploadText:{type:String,default:"上传封面"},reUploadText:{type:String,default:"重新上传"},multiple:{type:Boolean,default:!1}},data:function(){return{showDialog:!1,count:0,list:[],tmpImageUrl:""}},methods:{initData:function(){this.count=0,this.list=[]},handleAvatarSuccess:function(e,t){var s=this;if(0===e.errcode){if(!this.multiple)return setTimeout(function(){return s.tmpImageUrl=""}),this.onUploaded&&this.onUploaded(e.data);this.list.push(e.data),this.count===this.list.length&&this.onUploaded(this.list)}},beforeAvatarUpload:function(e){var t=this;if(!(e.size/1024/1024<=5))return this.multiple?(setTimeout(function(){return t.$message.error("『 ".concat(e.name," 』超过了5M，该图片已丢弃"))}),!1):(this.showDialog=!0,!1);this.count++},hideUploadDialog:function(){this.showDialog=!1},emitUpload:function(){this.hideUploadDialog(),this.$refs.uploadHandleRef.click()},changeImageHandler:function(e){var t=this;this.multiple||(this.tmpImageUrl=e.url||URL.createObjectURL(e.raw),setTimeout(function(){return t.initCropper()}))},initCropper:function(){this.$refs.tmpImage&&(i=new n.a(this.$refs.tmpImage,{aspectRatio:this.width/this.height,viewMode:1,center:!0,highlight:!0,cropBoxMovable:!0,cropBoxResizable:!0,ready:function(){}}))},saveCropImageHandler:function(){var e=this;i.getCroppedCanvas({width:this.width,height:this.height}).toBlob(function(t){var s=new File([t],"tmp.png"),a=e.$refs.uploader;a.clearFiles(),a.handleStart(s),a.submit()})}},computed:{apiHostName:function(){var e=window.location.hostname.split(".");return e.shift(),e.unshift("qi"),e.join(".")},uploadPreviewImageAction:function(){return"//".concat(this.apiHostName,"/v1/resources/temporaryFiles/uploadPreviewImage")}}},l=(s(655),s(3)),c=Object(l.a)(o,a,[],!1,null,null,null);c.options.__file="src/components/UploadCover/index.vue";t.a=c.exports},721:function(e,t,s){"use strict";var a={};s.r(a),s.d(a,"PRESENTABLE_STATUS_TIPS",function(){return u}),s.d(a,"default",function(){return p});var i={};s.r(i),s.d(i,"USER_GROUP_TYPE",function(){return d}),s.d(i,"NODE_GROUP_TYPE",function(){return v}),s.d(i,"GROUP_TYPES",function(){return m});var r=s(86),n=s.n(r),o=s(455),l=s(434),c=s(1),u=[{text:c.a.t("config.presentable.states[0]"),type:"info"},{text:c.a.t("config.presentable.states[1]"),type:"danger"},{text:c.a.t("config.presentable.states[2]"),type:"danger"},{text:c.a.t("config.presentable.states[3]"),type:"success"},{text:c.a.t("config.presentable.states[4]"),type:"info"},{text:c.a.t("config.presentable.states[5]"),type:"info"}],p=u,d=1,v=2,m=[{value:d,label:c.a.t("config.group.user")},{value:v,label:c.a.t("config.group.node")}],f=s(441);t.a=n()({},o,l,a,i,f)},894:function(e,t,s){"use strict";var a=s(662);s.n(a).a},895:function(e,t,s){"use strict";var a=s(663);s.n(a).a},896:function(e,t,s){"use strict";var a=s(664),i=s.n(a);t.default=i.a},972:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return null!==e.resourceDetail?s("div",{directives:[{name:"loading",rawName:"v-loading",value:null===e.resourceDetail,expression:"resourceDetail === null"}],attrs:{id:"release-create"}},[s("el-form",{ref:"createReleaseForm",staticClass:"r-c-w-cont",attrs:{model:e.formData,rules:e.rules}},[s("div",{staticClass:"r-c-w-row r-c-w-resource clearfix"},[s("div",{staticClass:"cont"},[s("h2",[s("img",{staticClass:"resource-default-preview",attrs:{alt:""}}),e._v(" "),s("span",[e._v(e._s(e.resourceDetail.aliasName))]),e._v(" "),s("div",{staticClass:"rcw-info"},[e._v("\n            "+e._s(e._f("pageBuildFilter")(e.resourceDetail.resourceType))+" | "+e._s(e._f("fmtDate")(e.resourceDetail.updateDate))+"\n          ")])]),e._v(" "),s("p",{staticClass:"rcw-intro"},[e._v("\n          "+e._s(e.resourceDetail.intro||e.$t("noDesc"))+"\n        ")])])]),e._v(" "),s("div",{staticClass:"r-c-w-row r-c-w-name"},[s("h3",[e._v(e._s(e.$t("name"))),s("span",[e._v("·"+e._s(e.$t("tips[0]")))])]),e._v(" "),s("el-form-item",{staticClass:"cont",attrs:{prop:"releaseName"}},[s("span",[e._v("*")]),e._v("\n        "+e._s(e.session.user.username)+" /\n        "),s("el-input",{attrs:{autofocus:"","validate-event":"","show-word-limit":"",maxlength:"100"},model:{value:e.formData.releaseName,callback:function(t){e.$set(e.formData,"releaseName",t)},expression:"formData.releaseName"}})],1)],1),e._v(" "),s("div",{staticClass:"r-c-w-row r-c-w-cover"},[s("h3",[e._v(e._s(e.$t("cover")))]),e._v(" "),s("UploadCover",{attrs:{imageUrl:e.coverImageUrl,onUploaded:e.uploadCoverSuccess}})],1),e._v(" "),e.depReleasesList.length?s("div",{staticClass:"r-c-w-row r-c-w-upcast"},[s("h3",[e._v(e._s(e.$t("basicUpcast"))),s("span",[e._v("·"+e._s(e.$t("tips[1]")))])]),e._v(" "),s("div",{staticClass:"cont"},[e._l(e.baseUpcastReleases,function(t,a){return s("div",{key:"upcast-release-"+a,staticClass:"upcast-release-item"},[s("i",{staticClass:"el-icon-back"}),e._v(e._s(t.releaseName)+"\n        ")])}),e._v(" "),0===e.baseUpcastReleases.length?s("div",{staticClass:"no-upcase-releases"},[e._v(e._s(e.$t("noBasicUpcast")))]):e._e()],2)]):e._e(),e._v(" "),s("div",{staticClass:"r-c-w-row r-c-w-version"},[s("h3",[e._v(e._s(e.$t("version")))]),e._v(" "),s("el-form-item",{staticClass:"cont",attrs:{prop:"version"}},[s("span",[e._v("*")]),e._v(" "),s("el-input",{model:{value:e.formData.version,callback:function(t){e.$set(e.formData,"version",t)},expression:"formData.version"}})],1)],1),e._v(" "),e.depReleasesList.length?s("div",{staticClass:"r-c-w-row r-c-w-scheme"},[s("h3",[e._v(e._s(e.$t("scheme")))]),e._v(" "),s("div",{staticClass:"cont"},[s("scheme-manage",{attrs:{type:"create",baseUpcastReleases:e.baseUpcastReleases,depReleasesList:e.depReleasesList,depReleasesDetailList:e.depReleasesDetailList},on:{"update:baseUpcastReleases":function(t){e.baseUpcastReleases=t},"update:base-upcast-releases":function(t){e.baseUpcastReleases=t},"update:depReleasesDetailList":function(t){e.depReleasesDetailList=t},"update:dep-releases-detail-list":function(t){e.depReleasesDetailList=t},"update-resolved-releases":e.updateResolvedReleases}})],1)]):e._e()]),e._v(" "),s("div",{staticClass:"r-c-w-footer"},[s("div",{staticClass:"body"},[s("div",{staticClass:"cancel",on:{click:e.cancelCreateRelease}},[e._v(e._s(e.$t("cancelBtnText")))]),e._v(" "),s("el-button",{staticClass:"create",attrs:{type:"primary",size:"small",round:""},on:{click:function(t){return e.createRelease("createReleaseForm")}}},[e._v(e._s(e.$t("createBtnText")))])],1)])],1):e._e()};a._withStripped=!0;var i=s(712),r=s(522),n=s(88),o=s(721),l={name:"release-creator",components:{SchemeManage:r.a,UploadCover:i.a},data:function(){var e=this.$i18n;return{resourceDetail:null,releaseName:"",coverImageUrl:"",formData:{releaseName:"",version:"0.1.0"},rules:{releaseName:[{required:!0,message:e.t("messages[3]"),trigger:"blur"},{validator:function(t,s,a){s.length<1||s.length>60?a(e.t("messages[0]")):o.a.COMMON_NAME_REGEXP.test(s)?a():a(e.t("messages[1]")+'： / : * ? " < > | @ # $')},trigger:"blur"}],version:[{required:!0,message:e.t("messages[4]"),trigger:"blur"},{validator:function(t,s,a){/^\d+\.\d+.\d+$/.test(s)?a():a(new Error(e.t("messages[2]")))},trigger:"blur"}]},baseUpcastReleases:[],depReleasesList:[],depReleasesDetailList:[],upcastDepReleasesIds:[],upcastDepReleasesMap:{},resolvedReleases:[]}},computed:Object.assign({projection:function(){return["releaseId","resourceType","releaseName","latestVersion","baseUpcastReleases","policies","updateDate"].join(",")},previewImage:function(){return this.resourceDetail&&this.resourceDetail.previewImages[0]||""}},Object(n.b)({session:"session"})),watch:{dependencies:function(){}},methods:{updateResolvedReleases:function(e){this.resolvedReleases=e},cancelCreateRelease:function(){this.$router.go(-1)},getFormData:function(){var e={resourceId:this.resourceDetail.resourceId,releaseName:this.formData.releaseName,version:this.formData.version,baseUpcastReleases:this.baseUpcastReleases.map(function(e){return{releaseId:e.releaseId}}),resolveReleases:this.resolvedReleases};return""!==this.coverImageUrl&&(e.previewImages=[this.coverImageUrl]),e},createRelease:function(e){var t=this,s=this.$i18n;this.$refs[e].validate(function(e){if(!e)return!1;var a=t.getFormData();t.$services.ReleaseService.post(a).then(function(e){return e.data}).then(function(e){0===e.errcode&&e.data?(t.$message({type:"success",message:s.t("messages[5]")}),e.data.releaseId&&t.$router.push("/release/edit/".concat(e.data.releaseId))):t.$message({type:"error",message:e.msg})}).catch(function(e){return t.$message({type:"error",message:e.toString()})})})},uploadCoverSuccess:function(e){this.coverImageUrl=e}},created:function(){var e=this;this.$route.query.resourceId&&this.$services.resource.get(this.$route.query.resourceId).then(function(e){return e.data}).then(function(t){0===t.errcode?(e.resourceDetail=t.data,e.depReleasesList=t.data.systemMeta.dependencies||[],e.formData.releaseName=t.data.aliasName):e.$message({type:"error",message:t.msg})}).catch(function(t){return e.$message({type:"error",message:t.toString()})})}},c=(s(894),s(895),s(3)),u=s(896),p=Object(c.a)(l,a,[],!1,null,"34309ea1",null);"function"==typeof u.default&&Object(u.default)(p),p.options.__file="src/views/release/create/index.vue";t.default=p.exports}}]);