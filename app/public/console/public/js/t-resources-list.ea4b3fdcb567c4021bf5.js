(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{432:function(e,t,a){"use strict";a.r(t),a.d(t,"RESOURCE_TYPES",function(){return n}),a.d(t,"RESOURCE_STATUS_MAP",function(){return r}),a.d(t,"RESOURCE_STATUS",function(){return i});var s=a(2),n={json:"json",widget:"widget",image:"image",audio:"audio",markdown:"markdown",page_build:"page_build",reveal_slide:"reveal_slide",license:"license",video:"video",catalog:"catalog"},r={unknown:0,unpublished:1,published:2,freeze:3},i=[{desc:s.a.t("config.resource.states[0]"),type:"danger",status:r.unknown},{desc:s.a.t("config.resource.states[1]"),type:"warning",status:r.unpublished},{desc:s.a.t("config.resource.states[2]"),type:"success",status:r.published},{desc:s.a.t("config.resource.states[3]"),type:"danger",status:r.freeze}]},433:function(e,t,a){},459:function(e,t,a){"use strict";var s=a(433);a.n(s).a},462:function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"fl-pagination"},[a("el-table",e._b({ref:"table",staticStyle:{width:"100%"},attrs:{"empty-text":e.emptyText},on:{"row-click":e.rowClickHandler,"selection-change":e.selectionChangeHandler}},"el-table",e.tableProps,!1),[e._t("list")],2),e._v(" "),0===e.tableProps.data.length?e._t("empty"):e._e(),e._v(" "),e.showFooter?a("div",{staticClass:"fl-pg-ft clearfix"},[e._t("footer"),e._v(" "),a("el-pagination",{staticClass:"fl-pg-info",attrs:{"current-page":e.currentPage,"page-sizes":[10,20,50],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],2):e._e()],2)};s._withStripped=!0;var n=a(6),r={name:"fl-pagination",props:{emptyText:{type:String,default:"暂无数据"},pagination:{type:Object,default:function(){return{pageSize:10}}},config:Object,rowClickHandler:{type:Function,default:function(){}},selectionChangeHandler:{type:Function,default:function(e){}},formatHandler:Function,showFooter:{type:Boolean,default:!0}},data:function(){return{total:8,tableProps:{data:[]},currentPage:1,pageSize:parseInt(window.sessionStorage.getItem("".concat(this.$route.fullPath,"_page_size")))||10,loading:!1}},watch:{pagination:{deep:!0,handler:function(){this.reload()}},pageSize:function(){this.reload()}},methods:{loadData:function(){if(!this.pagination.target)throw new Error("need pagination target param");var e={page:this.currentPage,pageSize:this.pageSize};return this.source=n.axios.CancelToken.source(),this.pagination.params&&Object.assign(e,this.pagination.params),this.$axios.get(this.pagination.target,{params:e,cancelToken:this.source.token}).then(function(e){if(e.data){if(0===e.data.ret&&0===e.data.errcode)return e.data.data;throw new Error(e.data.msg)}})},update:function(e){if(e&&e.dataList){this.total=e.totalItem||e.dataList.length;var t="function"==typeof this.formatHandler?this.formatHandler(e.dataList):e.dataList;this.tableProps.data=t}},reload:function(){this.currentPage=1,this.loading&&this.source&&(this.loading=!1,this.source.cancel("cancel")),this.load()},load:function(){var e=this;this.loading||(this.loading=!0,this.loadData().then(this.update.bind(this)).then(function(){e.loading=!1,window.sessionStorage.setItem("".concat(e.$route.fullPath,"_page_size"),e.pageSize)}).catch(function(t){t.message&&"cancel"===t.message||e.$error.showErrorMessage(t),e.loading=!1}))},handleSizeChange:function(e){this.pageSize=e},handleCurrentChange:function(e){this.currentPage=e,this.load()}},mounted:function(){Object.assign(this.tableProps,this.config),this.load()}},i=(a(459),a(3)),o=Object(i.a)(r,s,[],!1,null,null,null);o.options.__file="src/components/Pagination/index.vue";t.a=o.exports},477:function(e,t,a){"use strict";a.d(t,"c",function(){return n}),a.d(t,"b",function(){return r});var s=a(2),n=[{type:"free",template:"for public:\n  initial:\n    active\n    terminate\n  ",name:s.a.t("components.policyEditor.defaultPolicyNames.free")},{type:"charge",template:"for public:\n  escrow account acct\n  custom event acceptor.customEvent\n\n  initial:\n    recontractable\n    proceed to auth on acct exceed 1 feather\n  auth:\n    presentable\n    recontractable\n    active\n    proceed to refund on acct.confiscated\n  refund:\n    recontractable\n    proceed to finish on acct.refunded\n  finish:\n    recontractable\n    terminate\n  ",name:s.a.t("components.policyEditor.defaultPolicyNames.charge")}],r=[{type:"free",template:"for public:\n  initial:\n    active\n    terminate\n  ",name:s.a.t("components.policyEditor.defaultPolicyNames.free")},{type:"charge",template:"\n    for public:\n      escrow account acct\n      custom event acceptor.customEvent\n\n      initial:\n        proceed to auth on acct exceed 1 feather\n      auth:\n        presentable\n        active\n        proceed to refund on acct.confiscated\n      refund:\n        proceed to finish on acct.refunded\n      finish:\n        terminate",name:s.a.t("components.policyEditor.defaultPolicyNames.charge")}];t.a={release:n,presentable:r}},705:function(e,t,a){},706:function(e,t,a){},707:function(e,t){e.exports=function(e){e.options.__i18n=e.options.__i18n||[],e.options.__i18n.push('{"zh-CN":{"createBtnText":"创建资源","createNewReleaseText":"创建新发行","resourceListTitle":"资源列表","releaseListTitle":"发行列表","presentablesListTitle":"节点发行列表","resourceList":{"name":"资源名称","type":"资源类型","allTypes":"全部类型","history":"历史发行","status":"发行情况","updateDate":"更新时间","createDate":"创建时间","operate":"操作","querying":"查询中...","noReleases":"暂无发行","releaseBtnText":"发行","saveBtnText":"保存","detailBtnText":"详情","editBtnText":"编辑","downloadBtnText":"下载源文件","releasesCount":["等","个发行..."],"messages":["没有符合条件的资源","您还没有创建任何资源。"],"releaseStatus":["未发行","已发行","全部"]},"releaseList":{"name":"发行名称","type":"发行类型","newVersion":"最新版本","allTypes":"全部类型","view":"查看","policy":"策略","policyTpls":"节点发行策略模版","updateDate":"更新时间","createDate":"创建时间","operate":"操作","editBtnText":"编辑","createBtnText":"创建Presentable","tips":["策略已下架"],"messages":["没有符合条件的发行","您还没有创建任何发行。","您还没有收藏任何发行。您在发行市场收藏的发行之后将会出现在这里。","取消成功！"],"status":["未上线","已上线"]},"presentablesList":{"name":"节点发行名称","type":"类型","tags":"标签","onlineStatus":"在线状态","operate":"操作","saveBtnText":"保存","upgradeBtnText":"升级","editBtnText":"编辑","createBtnText":"创建Presentable"}},"en":{"createBtnText":"Create Resource","createNewReleaseText":"Create a New Release","resourceListTitle":"Resource List","releaseListTitle":"Release List","presentablesListTitle":"Presentable List","resourceList":{"name":"Resource name","type":"Resource type","allTypes":"All types","history":"Release history","status":"Release status","updateDate":"Update date","createDate":"Create date","operate":"Operate","querying":"Querying...","noReleases":"No releases","releaseBtnText":"Release","saveBtnText":"save","detailBtnText":"detail","editBtnText":"Edit","downloadBtnText":"Download resource file","releasesCount":["There are "," releases..."],"messages":["There are no resources available","You have not created any resources."],"releaseStatus":["Not release","Relased","All"]},"releaseList":{"name":"Release name","type":"Release type","newVersion":"New version","allTypes":"All types","view":"view","policy":"policy","policyTpls":"presentable policy template","updateDate":"Update date","createDate":"Create date","operate":"Operate","editBtnText":"Edit","createBtnText":"create presentable","tips":["All policies has been off the shelves"],"messages":["There are no releases available","You have not created any releases.","You haven\'t collected any releases yet. You will appear here after the release of your collection in the release market.","Cancel Successful！"],"status":["offline","online"]},"presentablesList":{"name":"name","type":"type","tags":"tags","onlineStatus":"online status","operate":"Operate","saveBtnText":"save","upgradeBtnText":"upgrade","editBtnText":"edit"}}}'),delete e.options._Ctor}},938:function(e,t,a){"use strict";var s=a(705);a.n(s).a},939:function(e,t,a){"use strict";var s=a(706);a.n(s).a},940:function(e,t,a){"use strict";var s=a(707),n=a.n(s);t.default=n.a},981:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tool-resource-list"},[a("div",{staticClass:"trl-header"},[a("el-dropdown",{staticClass:"trl-status-select",on:{command:e.handleSelectReleaseStatus}},[a("h3",{staticClass:"el-dropdown-link"},[a("span",[e._v(e._s(e.$t("resourceListTitle")))]),e._v(" "+e._s(e.releaseStatus[e.selectedReleaseStatus].label)),a("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.releaseStatus,function(t){return a("el-dropdown-item",{key:t.value,attrs:{command:t.value}},[e._v(e._s(t.label))])}),1)],1),e._v(" "),a("div",{staticClass:"trl-btn-group"},[a("el-button",{attrs:{type:"primary"},on:{click:e.refreshResourcesList}},[e._v("刷新列表")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.batchUpdateResources}},[e._v("批量更新资源")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.batchCreateReleases}},[e._v("批量创建新发行")])],1)],1),e._v(" "),a("f-pagination",{ref:"resourcesListRef",staticClass:"resource-list-table",attrs:{config:e.tableConfig,formatHandler:e.formatHandler,pagination:e.paginationConfig,"empty-text":e.pagenationEmptyText,selectionChangeHandler:e.handleSelectionChange}},[a("template",{slot:"list"},[a("el-table-column",{attrs:{type:"selection",width:"45",selectable:function(e){return 0===e.systemMeta.dependencies.length}}}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("resourceList.name")},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"r-l-item-name-box"},[t.row.isEdittingName?a("el-input",{attrs:{placeholder:"请输入资源名称"},model:{value:t.row.aliasName,callback:function(a){e.$set(t.row,"aliasName",a)},expression:"scope.row.aliasName"}}):a("div",{staticClass:"r-l-item-name"},[a("el-button",{attrs:{type:"primary",size:"mini"}},[e._v(e._s(t.row.dependType))]),e._v("\n              "+e._s(t.row.aliasName)+"\n              "),a("i",{staticClass:"el-icon-edit",on:{click:function(e){t.row.isEdittingName=!0}}})],1)],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:e.$t("resourceList.type"),width:"176"},scopedSlots:e._u([{key:"header",fn:function(t){return[a("el-dropdown",{staticClass:"r-l-types-select",on:{command:e.handleSelectType}},[a("span",{staticClass:"el-dropdown-link"},[e._v("\n              "+e._s(e.$t("resourceList.type"))+" "+e._s("all"===e.selectedType?"":" "+e.selectedType)),a("i",{staticClass:"el-icon-caret-bottom"})]),e._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.resourceTypes,function(t){return a("el-dropdown-item",{key:t.value,attrs:{command:t.value}},[e._v(e._s(t.label))])}),1)],1)]}},{key:"default",fn:function(t){return[a("div",{staticClass:"r-l-item-type"},[e._v(" "+e._s(t.row.resourceType))])]}}])}),e._v(" "),0===e.selectedReleaseStatus?a("el-table-column",{staticClass:"trl-tpls",attrs:{label:"发行策略模版",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"trl-tpls",class:{disabled:t.row.systemMeta.dependencies.length>0}},e._l(e.releasePolicyTpls,function(s){return a("el-radio",{key:s.type,staticClass:"p-tpl-radio",attrs:{label:s.type},model:{value:t.row.releasePolicyType,callback:function(a){e.$set(t.row,"releasePolicyType",a)},expression:"scope.row.releasePolicyType"}},[e._v(e._s(s.name))])}),1)]}}],null,!1,503175685)}):e._e(),e._v(" "),a("el-table-column",{attrs:{label:e.$t("resourceList.operate"),width:"240"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{attrs:{to:t.row._toDetailLink}},[a("el-button",{staticClass:"r-l-item-detail-btn",attrs:{size:"mini"}},[e._v(e._s(e.$t("resourceList.detailBtnText")))])],1),e._v(" "),a("el-button",{staticClass:"r-l-item-release-btn",attrs:{size:"mini"},on:{click:function(a){return e.tapRelease(t.row)}}},[e._v(e._s(e.$t("resourceList.releaseBtnText")))]),e._v(" "),a("el-button",{staticClass:"r-l-item-save-btn",attrs:{size:"mini"},on:{click:function(a){return e.tapSaveBtn(t.row)}}},[e._v(e._s(e.$t("resourceList.saveBtnText")))])]}}])})],1)],2),e._v(" "),a("el-dialog",{attrs:{width:"750px",top:"10vh",center:"",visible:e.isShowReleaseSearchDialog},on:{"update:visible":function(t){e.isShowReleaseSearchDialog=t}}},[a("release-search",{attrs:{"release-source":e.targetReleaseResource,tabLayout:["my-release"]},on:{add:e.releaseSearchHandler}}),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"create-release-btn",attrs:{round:"",type:"primary"},on:{click:e.tapCreateNewReleaseBtn}},[e._v(e._s(e.$t("createNewReleaseText")))])],1)],1)],1)};s._withStripped=!0;var n=a(87),r=a.n(n),i=a(462),o=a(496),l=a(432),c=a(477),u={name:"tool-resource-list",components:{FPagination:i.a,ReleaseSearch:o.a},props:{query:String},data:function(){var e=this.$i18n.t("resourceList.messages[1]"),t=this.$i18n,a=this.$route.query.resourceType;return{search:"",loader:null,tableConfig:{rowClassName:"resource-row","cell-class-name":"rel-row-cell","show-header":!0},paginationConfig:{target:"/v1/resources",params:{isSelf:1,resourceType:null!=a?a:void 0,keywords:void 0,isReleased:0}},resourceMapReleases:{},selectedType:null!=a?a:"all",releaseStatus:[{label:t.t("resourceList.releaseStatus[0]"),value:0},{label:t.t("resourceList.releaseStatus[1]"),value:1},{label:t.t("resourceList.releaseStatus[2]"),value:2}],selectedReleaseStatus:0,pagenationEmptyText:e,selectedResources:[],isShowReleaseSearchDialog:!1,targetReleaseResource:null}},computed:{resourceTypes:function(){for(var e=[{label:this.$i18n.t("resourceList.allTypes"),value:"all"}],t=0,a=Object.entries(l.RESOURCE_TYPES);t<a.length;t++){var s=r()(a[t],2),n=s[0],i=s[1];e.push({label:n,value:i})}return e},policyTplsMap:function(){var e={};return c.a.release.forEach(function(t){var a=t.type;e[a]=t}),e},releasePolicyTpls:function(){return c.a.release}},watch:{query:function(){var e=[this.$i18n.t("resourceList.messages[0]"),this.$i18n.t("resourceList.messages[1]")],t=e[0],a=e[1];""==this.query?(this.paginationConfig.params.keywords=void 0,this.pagenationEmptyText=a):(this.paginationConfig.params.keywords=this.query,this.pagenationEmptyText=t)},selectedReleaseStatus:function(){this.paginationConfig.params.isReleased=this.selectedReleaseStatus}},methods:{formatHandler:function(e){var t=this;return e&&e.length?((e=e.map(function(e){var a=e.resourceId,s=e.previewImages;return e._toDetailLink=a?"/resource/editor/".concat(a):"",e._downloadLink="".concat(window.FreelogApp.Env.qiOrigin,"/v1/resources/").concat(a,"/download"),e.previewImage=s&&s[0]||"",e.releaseStatus="fetching",e.releaseList=[],e.isEdittingName=!1,e.releasePolicyType="free",e.dependType=0===e.systemMeta.dependencies.length?"单一":"复合",t.fetchReleaseList(a).then(function(){e.releaseStatus="done",e.releaseList=t.resourceMapReleases[e.resourceId]}),e})).sort(function(e,t){return+new Date(t.updateDate)-+new Date(e.updateDate)}),e):[]},batchFetchReleaseList:function(e){for(var t=[],a=0;a<e.length;a++){var s=e[a].resourceId;this.resourceMapReleases[s]||t.push(this.fetchReleaseList(s))}return Promise.all(t)},fetchReleaseList:function(e){var t=this;return this.resourceMapReleases[e]?Promise.resolve(this.resourceMapReleases[e]):this.$services.ResourceService.get("".concat(e,"/releases")).then(function(e){return e.data}).then(function(a){0===a.errcode&&(t.resourceMapReleases[e]=a.data)})},updateResourceDetail:function(e){var t=this,a=e.aliasName,s=e.resourceId;return this.$services.resource.put(s,{aliasName:a}).then(function(e){return e.data}).then(function(a){return 0===a.errcode?(t.$message.success("".concat(e.aliasName,"更新成功！！！")),Promise.resolve()):(t.$message.error("".concat(e.aliasName,"更新失败！！！")),Promise.reject())})},createNewRelease:function(e){var t=this,a=e.resourceId,s=e.aliasName,n=e.policies;return this.$services.ReleaseService.post({resourceId:a,policies:n,releaseName:s,baseUpcastReleases:[],resolveReleases:[]}).then(function(e){return e.data}).then(function(e){return 0===e.errcode?(t.$message.success("“".concat(s,"”创建成功！！！")),Promise.resolve()):(t.$message.error("创建失败：".concat(e.msg,"！！！")),Promise.reject())})},goToReleaseDetail:function(e){e.releaseId&&this.$router.push("/release/detail/".concat(e.releaseId,"?version=").concat(e.resourceVersion.version))},handleSelectType:function(e){this.selectedType=e,this.$router.push({query:{resourceType:e}}),"all"===this.selectedType?this.paginationConfig.params.resourceType=void 0:this.paginationConfig.params.resourceType=this.selectedType},handleSelectReleaseStatus:function(e){this.selectedReleaseStatus=e,this.paginationConfig.params.isReleased=this.selectedReleaseStatus},tapRelease:function(e){this.isShowReleaseSearchDialog=!0,this.targetReleaseResource=e},releaseSearchHandler:function(e){this.$router.push("/release/add?releaseId=".concat(e.releaseId,"&resourceId=").concat(this.targetReleaseResource.resourceId))},tapCreateNewReleaseBtn:function(){this.$router.push("/release/create?resourceId=".concat(this.targetReleaseResource.resourceId))},tapSaveBtn:function(e){var t=this;this.updateResourceDetail(e).then(function(){t.refreshResourcesList()})},handleSelectionChange:function(e){this.selectedResources=e},refreshResourcesList:function(){this.$refs.resourcesListRef.reload()},batchUpdateResources:function(){var e=this,t=this.selectedResources.length,a=0;this.selectedResources.length?this.selectedResources.forEach(function(s){e.updateResourceDetail(s).then(function(){s.isEdittingName=!1}).finally(function(){t===++a&&e.refreshResourcesList()})}):this.$message.warning("请先选择需更新的资源")},batchCreateReleases:function(){var e=this,t=this.selectedResources.length,a=0;t?this.selectedResources.forEach(function(s){s.resourceId;var n=s.releasePolicyType,r=e.policyTplsMap[n],i=r.name,o=r.template;s.policies=[{policyName:i,policyText:window.btoa(o)}],e.createNewRelease(s).finally(function(){t===++a&&e.refreshResourcesList()})}):this.$message.warning("请先选择需发行的资源")}}},d=(a(938),a(939),a(3)),p=a(940),h=Object(d.a)(u,s,[],!1,null,"d31fefd8",null);"function"==typeof p.default&&Object(p.default)(h),h.options.__file="src/views/tools/resources-list.vue";t.default=h.exports}}]);