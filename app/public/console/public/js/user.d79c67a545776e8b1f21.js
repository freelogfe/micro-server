(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{546:function(e,t,a){},547:function(e,t,a){},548:function(e,t,a){},814:function(e,t,a){"use strict";var s=a(546);a.n(s).a},815:function(e,t,a){"use strict";var s=a(547);a.n(s).a},816:function(e,t,a){"use strict";var s=a(548);a.n(s).a},961:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"user-setting-view"},[a("el-form",{staticClass:"small-el-form",attrs:{"label-width":"120px","label-position":"left",rules:e.rules}},[a("el-form-item",{staticClass:"flex-grid",attrs:{label:e.$t("settingView.avatar")}},[a("el-button",{attrs:{type:"text"},on:{click:function(t){e.showImageCropUploader=!0}}},[a("img",{staticClass:"user-avatar",attrs:{src:e.userInfo.headImage,alt:""}})]),e._v(" "),a("CropImage",{attrs:{avatarUrl:e.avatarUrl,"upload-success":e.uploadSuccessHandler},model:{value:e.showImageCropUploader,callback:function(t){e.showImageCropUploader=t},expression:"showImageCropUploader"}})],1),e._v(" "),a("el-form-item",{staticClass:"flex-grid",attrs:{label:e.$t("settingView.username")}},[a("el-input",{staticClass:"input-area",attrs:{disabled:"",placeholder:e.$t("settingView.usernameTip")},model:{value:e.userInfo.userName,callback:function(t){e.$set(e.userInfo,"userName",t)},expression:"userInfo.userName"}})],1),e._v(" "),a("el-form-item",{staticClass:"flex-grid",attrs:{label:e.$t("settingView.nickname")}},[a("el-input",{staticClass:"input-area",attrs:{disabled:"",placeholder:e.$t("settingView.nicknameTip")},model:{value:e.userInfo.nickname,callback:function(t){e.$set(e.userInfo,"nickname",t)},expression:"userInfo.nickname"}})],1),e._v(" "),a("el-form-item",{staticClass:"flex-grid",attrs:{label:e.$t("settingView.email")}},[a("el-input",{staticClass:"input-area",attrs:{disabled:"",placeholder:"未设置邮箱"},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1),e._v(" "),a("el-form-item",{staticClass:"flex-grid",attrs:{label:e.$t("settingView.mobilePhone")}},[a("el-input",{staticClass:"input-area",attrs:{disabled:"",placeholder:e.$t("settingView.mobilePhoneTip")},model:{value:e.userInfo.mobile,callback:function(t){e.$set(e.userInfo,"mobile",t)},expression:"userInfo.mobile"}})],1),e._v(" "),a("el-form-item",{staticClass:"form-footer"})],1)],1)};s._withStripped=!0;var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"crop-image-wrap"},[e._t("default"),e._v(" "),a("el-dialog",{attrs:{visible:e.show,width:"550px","before-close":e.handleClose},on:{"update:visible":function(t){e.show=t}}},[a("div",{staticClass:"crop-image-bd"},[a("div",{staticClass:"crop-img-container"},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.imageUrl,expression:"imageUrl"}],staticClass:"crop-img-selection"},[a("img",{ref:"avatarRef",staticClass:"avatar",attrs:{src:e.imageUrl,crossOrigin:"anonymous",alt:""}})]),e._v(" "),a("el-upload",{ref:"uploader",staticClass:"avatar-uploader",attrs:{action:e.updateAction,"with-credentials":!0,"auto-upload":!1,"show-file-list":!1,"on-change":e.changeImageHandler,"on-success":e.handleAvatarSuccess}},[e.imageUrl?a("el-button",[e._v(e._s(e.$t("components.cropImage.reUpload")))]):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1),e._v(" "),e.imageUrl?a("el-button",{staticClass:"save-crop-img-btn",attrs:{type:"primary"},on:{click:e.saveCropImageHandler}},[e._v(e._s(e.$t("common.save"))+"\n        ")]):e._e()],1),e._v(" "),e.imageUrl?a("div",{staticClass:"crop-img-preview"}):e._e()])])],2)};i._withStripped=!0;var r=a(544),o=a.n(r);a(545);var n={name:"crop-image",data:function(){return{imageUrl:"",show:!1}},props:{value:{type:Boolean,default:!0},uploadSuccess:Function,avatarUrl:String},mounted:function(){this.show=this.value,this.imageUrl=this.avatarUrl||"",this.imageUrl&&this.initCropper()},watch:{value:function(){var e=this;this.show=this.value,this.imageUrl&&setTimeout(function(){e.initCropper()})},avatarUrl:function(){this.imageUrl=this.avatarUrl||""}},methods:{initCropper:function(){this.$refs.avatarRef&&(this.cropper?this.cropper.replace(this.imageUrl):this.cropper=new o.a(this.$refs.avatarRef,{aspectRatio:1,viewMode:1,center:!0,highlight:!0,cropBoxMovable:!0,cropBoxResizable:!0,ready:function(){},preview:".crop-img-preview"}))},handleClose:function(){this.show=!1,this.$emit("input",!1)},changeImageHandler:function(e){var t=this;this.imageUrl=e.url||URL.createObjectURL(e.raw),setTimeout(function(){t.initCropper()})},handleAvatarSuccess:function(e){e.ret||e.errcode?this.$error.showErrorMessage(e.msg):("function"==typeof this.uploadSuccess&&this.uploadSuccess(e.data),this.$emit("success",e.data))},saveCropImageHandler:function(){var e=this;this.cropper.getCroppedCanvas({width:160,height:160}).toBlob(function(t){var a=new File([t],"avatar.png"),s=e.$refs.uploader;s.clearFiles(),s.handleStart(a),s.submit()})}},computed:{updateAction:function(){return"".concat(window.FreelogApp.Env.qiOrigin,"/v1/userinfos/uploadHeadImg")}}},l=(a(814),a(3)),c=Object(l.a)(n,i,[],!1,null,null,null);c.options.__file="src/components/CropImage/index.vue";var u=c.exports,p=a(88),m={name:"user-setting-view",data:function(){return{rules:{},userInfo:{},avatarUrl:"",showImageCropUploader:!1}},components:{CropImage:u},computed:Object(p.b)({session:"session"}),mounted:function(){this.userInfo=this.session.user,this.avatarUrl=this.userInfo.headImage},methods:{saveHandler:function(){},uploadSuccessHandler:function(){this.showImageCropUploader=!1,this.$store.dispatch("changeAvatar")}}},d=(a(815),a(816),Object(l.a)(m,s,[],!1,null,"8233d5ae",null));d.options.__file="src/views/user/setting/index.vue";t.default=d.exports}}]);