{"version":3,"sources":["pages/book/component/chapter.js"],"names":["Chapter","props","useState","hovered","setHovered","nextHovered","setNextHovered","preHovered","setPreHovered","chapters","current","chapterIndex","setChapterIndex","chapter","setChapter","tapTime","setTaptime","scrollRef","useRef","getChapter","index","a","window","freelogApp","getFileStreamById","presentableId","ch","data","errCode","Promise","resolve","rej","addAuth","res","immediate","scrollTop","useEffect","className","onClick","setVisible","onTouchStart","onTouchEnd","presentableName","ref","Date","getTime","console","log","length"],"mappings":"2OAEe,SAASA,EAAQC,GAAQ,IAAD,EACPC,oBAAS,GADF,mBAC9BC,EAD8B,KACrBC,EADqB,OAECF,oBAAS,GAFV,mBAE9BG,EAF8B,KAEjBC,EAFiB,OAGDJ,oBAAS,GAHR,mBAG9BK,EAH8B,KAGlBC,EAHkB,KAI/BC,EAAWR,EAAMS,QAAQD,SAJM,EAKGP,mBAASD,EAAMS,QAAQC,cAL1B,mBAK9BA,EAL8B,KAKhBC,EALgB,OAMPV,mBAASO,EAASE,IANX,mBAM9BE,EAN8B,KAMrBC,EANqB,OAOPZ,mBAAS,GAPF,mBAO9Ba,EAP8B,KAOrBC,EAPqB,KAQ/BC,EAAYC,iBAAO,MARY,SAUtBC,EAVsB,8EAUrC,WAA0BC,GAA1B,eAAAC,EAAA,0DACMZ,EAASW,GADf,iCAEmBE,OAAOC,WAAWC,kBAAkBf,EAASW,GAAOK,eAFvE,YAEQC,EAFR,QAGWC,KAAKC,QAHhB,gCAIiB,IAAIC,SAAQ,SAACC,EAASC,GAC/BT,OAAOC,WAAWS,QAAQN,EAAGC,KAAKF,cAAlC,sBAAiD,4BAAAJ,EAAA,sEAC5BC,OAAOC,WAAWC,kBAAkBf,EAASW,GAAOK,eADxB,OACzCQ,EADyC,OAE/CH,EAAQG,GAFuC,4CAG9C,cAAW,CAAEC,WAAW,OARnC,OAIMR,EAJN,cAWId,EAAgBQ,GAChBN,EAAW,2BAAKL,EAASW,IAAf,IAAuBO,KAAMD,EAAGC,QAC1CV,EAAUP,QAAQyB,UAAY,EAblC,6CAVqC,sBA8BrC,OAHAC,qBAAU,WACRjB,EAAWR,KACV,IAED,sBAAK0B,UAAU,wEAAf,UACE,sBAAKA,UAAU,6DAAf,UACE,qBACEA,WACGlC,EAAU,iBAAmB,WAC9B,4BAEFmC,QAAS,WACPrC,EAAMsC,YAAW,IAEnBC,aAAc,WACZpC,GAAW,IAEbqC,WAAY,WACVrC,GAAW,IAZf,eAiBA,qBAAKiC,UAAU,qBAAf,SACE,qBAAKA,UAAU,iEAAf,SACGxB,EAAQ6B,uBAIf,qBAAKL,UAAU,uBAAf,SACE,sBAAKA,UAAU,2DAA2DM,IAAK1B,EAA/E,UACE,mBAAGoB,UAAU,wCAAb,SAAsDxB,EAAQc,MAAQ,KACtE,qBAAKU,UAAU,6CAAf,+CAKJ,sBAAKA,UAAU,mCAAf,UACE,qBACEA,WACG9B,EAAa,iBAAmB,IACjC,4CACkB,IAAjBI,EAAqB,mBAAqB,IAE7C6B,aAAc,WACZxB,GAAW,IAAI4B,MAAOC,WACtBC,QAAQC,IAAI,OACZvC,GAAc,IAEhBiC,WAAY,YACN,IAAIG,MAAOC,UAAY9B,EAAU,KAAM,IAAI6B,MAAOC,UAAY9B,EAAU,KAC1EI,EAAWR,EAAe,GAE5BH,GAAc,IAflB,gCAoBA,sBAAK6B,UAAU,mCAAf,UACG1B,EAAe,EADlB,IACsBF,EAASuC,UAE/B,qBACEX,WACGhC,EAAc,iBAAmB,IAClC,4CACCM,IAAiBF,EAASuC,OAAS,EAAI,mBAAqB,IAE/DR,aAAc,WACZxB,GAAW,IAAI4B,MAAOC,WACtBvC,GAAe,IAEjBmC,WAAY,YACN,IAAIG,MAAOC,UAAY9B,EAAU,KAAM,IAAI6B,MAAOC,UAAY9B,EAAU,KAC1EI,EAAWR,EAAe,GAE5BL,GAAe,IAdnB","file":"static/js/4.e0147098.chunk.js","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\n\r\nexport default function Chapter(props) {\r\n  const [hovered, setHovered] = useState(false);\r\n  const [nextHovered, setNextHovered] = useState(false);\r\n  const [preHovered, setPreHovered] = useState(false);\r\n  const chapters = props.current.chapters;\r\n  const [chapterIndex, setChapterIndex] = useState(props.current.chapterIndex);\r\n  const [chapter, setChapter] = useState(chapters[chapterIndex]);\r\n  const [tapTime, setTaptime] = useState(0);\r\n  const scrollRef = useRef(null);\r\n\r\n  async function getChapter(index) {\r\n    if (chapters[index]) {\r\n      let ch = await window.freelogApp.getFileStreamById(chapters[index].presentableId)\r\n      if (ch.data.errCode) {\r\n        ch = await new Promise((resolve, rej) => {\r\n          window.freelogApp.addAuth(ch.data.presentableId, async () => {\r\n            const res  = await window.freelogApp.getFileStreamById(chapters[index].presentableId)\r\n            resolve(res)\r\n          }, () => { }, { immediate: true })\r\n        })\r\n      }\r\n      setChapterIndex(index)\r\n      setChapter({ ...chapters[index], data: ch.data });\r\n      scrollRef.current.scrollTop = 0\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    getChapter(chapterIndex)\r\n  }, []);\r\n  return (\r\n    <div className=\"p-absolute w-100x h-100x over-h flex-column z-100  fadeInDown bg-less\">\r\n      <div className=\"flex-row w-100x over-h align-center py-10 pr-10 bb-1 b-box\">\r\n        <div\r\n          className={\r\n            (hovered ? \" fc-nav-active\" : \"fc-less\") +\r\n            \" fs-40 mb-10 px-20 pl-10 \"\r\n          }\r\n          onClick={() => {\r\n            props.setVisible(false);\r\n          }}\r\n          onTouchStart={() => {\r\n            setHovered(true);\r\n          }}\r\n          onTouchEnd={() => {\r\n            setHovered(false);\r\n          }}\r\n        >\r\n          x\r\n        </div>\r\n        <div className=\"flex-1 over-h h-55\">\r\n          <div className=\"fs-30 text-ellipsis w-100x b-box text-align-center pr-40 lh-55\">\r\n            {chapter.presentableName}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"flex-1 w-100x over-h\">\r\n        <div className=\"w-100x h-100x y-auto fs-35 px-20 pt-30 flex-column b-box\" ref={scrollRef}>\r\n          <p className=\"lh-50 ls-4 text-pre-wrap px-10 flex-1\">{chapter.data || ''}</p>\r\n          <div className=\"fc-less w-100x  py-30 text-center f-italic\">\r\n            本章结束....\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div className=\"flex-row fs-30 bt-1 align-center\">\r\n        <div\r\n          className={\r\n            (preHovered ? \" fc-nav-active\" : \"\") +\r\n            \" w-260 text-align-center py-20 bg-white \" +\r\n            (chapterIndex === 0 ? \"fc-less disabled\" : \"\")\r\n          }\r\n          onTouchStart={() => {\r\n            setTaptime(new Date().getTime())\r\n            console.log(23232);\r\n            setPreHovered(true);\r\n          }}\r\n          onTouchEnd={() => {\r\n            if (new Date().getTime() - tapTime > 50 && new Date().getTime() - tapTime < 500) {\r\n              getChapter(chapterIndex - 1);\r\n            }\r\n            setPreHovered(false);\r\n          }}\r\n        >\r\n          上一章\r\n        </div>\r\n        <div className=\"flex-1 bg-less text-align-center\">\r\n          {chapterIndex + 1}/{chapters.length}\r\n        </div>\r\n        <div\r\n          className={\r\n            (nextHovered ? \" fc-nav-active\" : \"\") +\r\n            \" w-260 text-align-center py-20 bg-white \" +\r\n            (chapterIndex === chapters.length - 1 ? \"fc-less disabled\" : \"\")\r\n          }\r\n          onTouchStart={() => {\r\n            setTaptime(new Date().getTime())\r\n            setNextHovered(true);\r\n          }}\r\n          onTouchEnd={() => {\r\n            if (new Date().getTime() - tapTime > 50 && new Date().getTime() - tapTime < 500) {\r\n              getChapter(chapterIndex + 1);\r\n            }\r\n            setNextHovered(false);\r\n          }}\r\n        >\r\n          下一章\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"sourceRoot":""}