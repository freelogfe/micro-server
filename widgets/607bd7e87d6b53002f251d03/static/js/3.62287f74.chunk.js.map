{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","utils/utils.js","pages/book/book.js"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","push","apply","_objectSpread2","target","i","arguments","length","source","forEach","getOwnPropertyDescriptors","defineProperties","toChinesNum","num","changeNum","unit","parseInt","getWan","temp","strArr","toString","split","reverse","newNum","overWan","Math","floor","noWan","Chapter","lazy","withRouter","props","bookId","match","params","id","useState","bookInfo","setBookInfo","chapters","setChapters","useEffect","a","window","freelogApp","getPresentablesSearch","presentableIds","res","getResourceInfoById","bookResource","console","log","data","errCode","Promise","resolve","rej","addAuth","presentableId","book","immediate","intro","getPresentables","resourceType","tags","presentableName","isLoadVersionProperty","chaptersRes","chaptersData","dataList","sort","b","aIndex","bIndex","versionProperty","chapter","e","map","item","index","chapterIndex","current","setCurrent","visible","setVisible","hovered","setHovered","className","flag","onClick","history","onTouchStart","onTouchEnd"],"mappings":"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","file":"static/js/3.62287f74.chunk.js","sourcesContent":["export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}","export const toChinesNum = (num) => {\r\n    let changeNum = ['零', '一', '二', '三', '四', '五', '六', '七', '八', '九'];\r\n    let unit = [\"\", \"十\", \"百\", \"千\", \"万\"];\r\n    num = parseInt(num);\r\n    let getWan = (temp) => {\r\n    　　let strArr = temp.toString().split(\"\").reverse();\r\n    　　let newNum = \"\";\r\n    　　for (var i = 0; i < strArr.length; i++) {\r\n      　　newNum = (i == 0 && strArr[i] == 0 ? \"\" : (i > 0 && strArr[i] == 0 && strArr[i - 1] == 0 ? \"\" : changeNum[strArr[i]] + (strArr[i] == 0 ? unit[0] : unit[i]))) + newNum;\r\n    　　}\r\n     　 return newNum;\r\n   }\r\n   let overWan = Math.floor(num / 10000);\r\n   let noWan = num % 10000;\r\n   if (noWan.toString().length < 4) {　　　　　　noWan = \"0\" + noWan;　　　 }\r\n   return overWan ? getWan(overWan) + \"万\" + getWan(noWan) : getWan(num);\r\n}","import React, { lazy, useState, useEffect } from \"react\";\r\nimport { withRouter, Link } from \"react-router-dom\";\r\nimport {toChinesNum} from '../../utils/utils'\r\n\r\nconst Chapter = lazy(() => import(\"./component/chapter\"));\r\nfunction Book(props) {\r\n  const bookId = props.match.params.id;\r\n  const [bookInfo, setBookInfo] = useState({});\r\n  const [chapters, setChapters] = useState([]);\r\n\r\n  useEffect(async() => {\r\n    const res = await window.freelogApp.getPresentablesSearch({presentableIds: bookId})\r\n    let bookResource = await window.freelogApp.getResourceInfoById(bookId)\r\n    console.log(res, bookResource)\r\n    if (bookResource.data.errCode) {\r\n      bookResource = await new Promise((resolve, rej) => {\r\n        console.log(bookResource)\r\n        window.freelogApp.addAuth(bookResource.data.presentableId, async () => {\r\n          const book = await window.freelogApp.getResourceInfoById(bookId)\r\n          console.log(resolve)\r\n          resolve && resolve(book)\r\n        }, () => { }, { immediate: true })\r\n      })\r\n    }\r\n    console.log(bookResource)\r\n    setBookInfo({...res.data.data[0], intro: bookResource.data.data.intro})\r\n    const chaptersRes = await window.freelogApp.getPresentables({ resourceType: \"chapter\", tags: res.data.data[0].presentableName, isLoadVersionProperty: 1})\r\n    let chaptersData = chaptersRes.data.data.dataList\r\n    console.log(chaptersData)\r\n    chaptersData.sort((a,b)=>{\r\n      let aIndex = 0\r\n      let bIndex = 1\r\n      try{\r\n         aIndex = parseInt(a.versionProperty.chapter)\r\n         bIndex = parseInt(b.versionProperty.chapter)\r\n      }catch(e){\r\n        console.log(\"chapter 设置错误 \" + a.presentableName + ' 或者 ' + b.presentableName )\r\n      }\r\n      return aIndex - bIndex\r\n    })\r\n    chaptersData = chaptersData.map((item, index)=>{\r\n      item.chapterIndex = '第' + toChinesNum(index + 1) + '章'  \r\n      return item\r\n    })\r\n    setChapters(chaptersRes.data.data.dataList || [])\r\n  }, []);\r\n  \r\n  \r\n  const [current, setCurrent] = useState(false);\r\n  const [visible, setVisible] = useState(false);\r\n  const [hovered, setHovered] = useState(false);\r\n\r\n  function setChapterVisible(flag){\r\n    setVisible(!!flag)\r\n  }\r\n   return (\r\n    <div className=\"flex-column w-100x h-100x over-h\">\r\n      {visible?  <Chapter current={current} setVisible={setChapterVisible} /> : ''}\r\n     \r\n      <div className=\"bg-white bb-1 px-20 py-15 flex-row shrink-0\">\r\n        <div\r\n          onClick={() => {\r\n            props.history.push(\"/\");\r\n          }}\r\n          onTouchStart={()=>{\r\n            console.log(23232)\r\n            setHovered(true)\r\n          }}\r\n          onTouchEnd={()=>{\r\n            setHovered(false)\r\n          }}\r\n          className={\"text-ellipsis flex-row align-center\" + (hovered? ' fc-nav-active': '')}\r\n        >\r\n          <div className={\"mr-5 fs-40 pb-5\"  + (!hovered? ' fc-less': '')}>&lt;</div>{\" \"}\r\n          <div className=\"fs-30 text-ellipsis flex-1 lh-55\">{bookInfo.presentableName}</div>\r\n        </div>\r\n      </div>\r\n      <div className=\"flex-1 over-h w-100x\">\r\n        <div className=\"flex-column h-100x y-auto w-100x\">\r\n          {/* 简介 */}\r\n          <div className=\"flex-column bb-1\">\r\n            <div className=\"fw-bold fs-35 py-20 bg-less px-20\">简介</div>\r\n            <div className=\"fs-30 px-30 py-20 mb-20 lh-50\">\r\n              {bookInfo.intro? <p className=\"\">{bookInfo.intro}</p> : <span className=\"fc-less f-italic\">暂无</span>}\r\n            </div>\r\n          </div>\r\n          {/* 章节 */}\r\n          <div className=\"flex-column\">\r\n            <div className=\"fw-bold fs-35 py-20 px-20 bg-less\">\r\n              章节（共{chapters.length}章）\r\n            </div>\r\n            {chapters.map((item, index) => {\r\n              return (\r\n                <div key={index} className=\"fs-30 pl-40 pr-10 py-30 bb-1 text-pre-wrap\" onClick={() => {\r\n                  setCurrent({bookInfo, chapters, chapterIndex: index })\r\n                  setVisible(true)\r\n                }}>\r\n                  {item.chapterIndex + '      '  + item.presentableName}\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n          <div className=\"fc-less w-100x mb-20 mt-10 text-center f-italic fs-30\">到底啦....</div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\nexport default withRouter(Book);\r\n"],"sourceRoot":""}