(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["freelog-waterfall-app"]=t():e["freelog-waterfall-app"]=t()})(window,(function(){return function(e){function t(t){for(var a,i,o=t[0],c=t[1],l=t[2],d=0,p=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(r,i)&&r[i]&&p.push(r[i][0]),r[i]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a]);u&&u(t);while(p.length)p.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],a=!0,o=1;o<n.length;o++){var c=n[o];0!==r[c]&&(a=!1)}a&&(s.splice(t--,1),e=i(i.s=n[0]))}return e}var a={},r={app:0},s=[];function i(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=a,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp_freelog-waterfall"]=window["webpackJsonp_freelog-waterfall"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var u=c;return s.push([0,"chunk-vendors"]),n()}({0:function(e,t,n){e.exports=n("56d7")},"02a8":function(e,t,n){},"13a3":function(e,t,n){},"37cb":function(e,t,n){"use strict";n("3a5d")},"3a5d":function(e,t,n){},4364:function(e,t,n){"use strict";n("b9d8")},"498c":function(e,t,n){"use strict";n("9983")},"4aef":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t),n.d(t,"bootstrap",(function(){return Ee})),n.d(t,"mount",(function(){return $e})),n.d(t,"unmount",(function(){return Ve}));var a=n("1da1"),r=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("96cf"),n("b0c0"),n("ca62"),n("0fae"),n("2b0e")),s=n("8c4f"),i=n("5c96"),o=n.n(i),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("router-view")],1)},l=[],u={name:"app"},d=u,p=n("2877"),m=Object(p["a"])(d,c,l,!1,null,null,null),h=m.exports,f=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingVisible,expression:"loadingVisible"}],staticClass:"i18n-management-container",attrs:{"element-loading-background":"rgba(255, 255, 255, 0.5)"}},[n("div",{staticClass:"imc-header"},[n("h2",[e._v("Freelog I18n")]),n("div",{staticClass:"repos-select-box"},[n("el-dropdown",{on:{command:e.selectRepository}},[n("span",{staticClass:"el-dropdown-link"},[n("span",[e._v("仓库名称：")]),e._v(" "+e._s(e.selectedReposName)+" "),n("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.trackedRepositories,(function(t){return n("el-dropdown-item",{key:t.repositoryName,attrs:{command:t.repositoryName}},[e._v(" "+e._s(t.repositoryName)+" ")])})),1)],1)],1),n("el-button-group",e._l(e.modes,(function(t){return n("el-button",{key:t.mode,attrs:{type:t.mode===e.mode?"primary":"default"},on:{click:function(n){e.mode=t.mode}}},[e._v(" "+e._s(t.label)+" ")])})),1),n("div",{staticClass:"repos-btns-box"},[n("repository-push-btn",{attrs:{repositoryName:e.selectedReposName,repositoryChanges:e.selectedReposChanges},on:{"update:repositoryChanges":function(t){e.selectedReposChanges=t},"update:repository-changes":function(t){e.selectedReposChanges=t}}}),n("el-tooltip",{staticClass:"repos-commits",attrs:{content:"查看提交记录"}},[n("a",{attrs:{href:e.reposCommitsUrl,target:"_blank"}},[n("el-button",{attrs:{icon:"el-icon-time",circle:""}})],1)])],1)],1),null!=e.selectedRepository&&null!=e.allModuleData?n("div",{staticClass:"i-m-main-content"},[n("file-edit-view",{directives:[{name:"show",rawName:"v-show",value:e.targetComponentId===e.modes[0].id,expression:"targetComponentId === modes[0].id"}],attrs:{repository:e.selectedRepository,fetchJSONFileContent:e.fetchJSONFileContent},on:{"update-repository-changes":e.updateRepositoryChanges,"update-cache-JSONString":e.updateCacheJSONString}}),e.targetComponentId===e.modes[1].id?n("namespace-edit-view",{attrs:{repository:e.selectedRepository,allModuleData:e.allModuleData,languages:e.languages},on:{"add-module-success":e.addModuleSuccess,"del-module-success":e.delModuleSuccess,"update-repository-changes":e.updateRepositoryChanges,"update-cache-JSONString":e.updateCacheJSONString}}):e._e(),e.targetComponentId===e.modes[2].id?n("tags-edit-view",{attrs:{languages:e.languages,repository:e.selectedRepository,allModuleData:e.allModuleData}}):e._e()],1):e._e()])},g=[],y=n("2909"),v=n("b85c"),b=(n("99af"),n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),n("6e87")),M=n.n(b),k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-popover",{attrs:{placement:"bottom",width:"480",trigger:"hover",disabled:!e.repositoryChanges.length},model:{value:e.showUpdatePopover,callback:function(t){e.showUpdatePopover=t},expression:"showUpdatePopover"}},[n("el-badge",{directives:[{name:"loading",rawName:"v-loading",value:e.isPushing,expression:"isPushing"}],staticClass:"item",attrs:{slot:"reference","element-loading-background":"rgba(255, 255, 255, .5)",value:e.repositoryChanges.length,hidden:0===e.repositoryChanges.length},slot:"reference"},[n("el-button",{attrs:{disabled:0===e.repositoryChanges.length}},[e._v(" "+e._s(e.isPushing?"提交中":"提交变更")+" "),n("i",{directives:[{name:"show",rawName:"v-show",value:!e.isPushing,expression:"!isPushing"}],staticClass:"el-icon-circle-plus-outline"})])],1),null!=e.githubUser?n("div",{staticClass:"imc-github-user"},[e._v(" Signed in as "),n("a",{attrs:{href:e.githubUser.html_url}},[e._v(e._s(e.githubUser.login))])]):e._e(),n("div",{staticClass:"imc-repos-commit-box"},[n("p",[e._v("Commit Message: "),""===e.commitMsg?n("span",{staticStyle:{color:"#F56C6C"}},[e._v("不能为空")]):e._e()]),n("div",{staticClass:"imc-commitMsg"},[n("el-tag",{attrs:{size:"mini"},on:{click:e.addMsgForUpdateKey}},[e._v("文案更新")]),n("el-tag",{attrs:{size:"mini"},on:{click:e.addMsgForAddModule}},[e._v("模块更新")]),n("el-tag",{attrs:{size:"mini"},on:{click:e.addMsgForTest}},[e._v("测试")])],1),n("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.commitMsg,callback:function(t){e.commitMsg=t},expression:"commitMsg"}})],1),n("div",{staticClass:"imc-repos-changes-box"},[n("h4",[e._v("共"+e._s(e.repositoryChanges.length)+"个文件变更：")]),e._l(e.repositoryChanges,(function(t,a){return n("p",{key:"change"+a,staticClass:"imc-repos-change-item"},[n("span",{class:[t.type]},[e._v(e._s(t.type)+": ")]),e._v(" "+e._s(t.path)),n("a",{attrs:{href:"//i18n-ts.testfreelog.com/v1/file/download?repositoryName="+e.repositoryName+"&filePath="+t.path,target:"_blank"}},[e._v("下载")])])}))],2),n("div",{staticStyle:{"text-align":"right"}},[n("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){e.showUpdatePopover=!1}}},[e._v("取消")]),n("el-button",{attrs:{type:"primary",size:"mini",disabled:""===e.commitMsg},on:{click:e.commitAndPushChanges}},[e._v("提交")])],1)],1)},w=[],N=(n("25f0"),n("a15b"),n("fb6a"),n("4d63"),n("ac1f"),n("5319"),"__ALL_MODULES__"+(new Date).getTime()),S="I18n_NOT_PUSH_MODULES",K="I18n_NOT_PUSH_KEYS",O={name:"i18n-management-repository-push",components:{},props:{repositoryName:String,repositoryChanges:Array},data:function(){return{showUpdatePopover:!1,showEmptyCommitError:!1,commitMsg:"",isPushing:!1,showGithubOAuthBtn:!1,githubUser:null}},methods:{commitAndPushChanges:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.repositoryChanges,console.log(e.repositoryName),0!==n.length){t.next=4;break}return t.abrupt("return");case 4:if(""!==e.commitMsg){t.next=6;break}return t.abrupt("return");case 6:return t.prev=6,e.isPushing=!0,a=localStorage.getItem("github_access_toekn"),t.next=11,window.fetch("//i18n-ts.testfreelog.com/v1/i18nRepository/changes/push",{method:"POST",body:JSON.stringify({repositoryName:e.repositoryName,commitMsg:e.commitMsg,accessToken:a}),headers:{"content-type":"application/json"}}).then((function(e){return e.json()}));case 11:r=t.sent,0===r.errcode?(e.clearNotPushInfo(),e.showUpdatePopover=!1,e.$emit("update:repositoryChanges",[]),e.$message.success("提交成功！"),e.commitMsg=""):e.$message.error(r.msg),t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](6),e.$message.error(t.t0.toString()),console.error("commitAndPushChanges - e",t.t0);case 19:return t.prev=19,e.isPushing=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[6,15,19,22]])})))()},getGithubUserInfo:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=localStorage.getItem("github_access_toekn"),null==n){t.next=8;break}return t.next=4,e.$axios.get("/v1/i18n/getGithubUserInfo?accessToken=".concat(n)).then((function(e){return e.data}));case 4:if(a=t.sent,0!==a.errcode){t.next=8;break}return e.githubUser=a.data,t.abrupt("return");case 8:e.showGithubOAuthBtn=!0;case 9:case"end":return t.stop()}}),t)})))()},refreshGithubAccessToken:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.$route.query.code){t.next=7;break}return t.next=3,e.$axios.post("/v1/i18n/getGithubAccessToken",{client_id:"874c97335a3e4df726af",client_secret:"3009d76fc4b7ed4914cfa57019166e8d764625fe",code:e.$route.query.code}).then((function(e){return e.data}));case 3:if(n=t.sent,0!==n.errcode){t.next=7;break}return localStorage.setItem("github_access_toekn",n.data.access_token),t.abrupt("return",n.data.access_token);case 7:case"end":return t.stop()}}),t)})))()},addMsgForUpdateKey:function(){var e="",t=localStorage.getItem(K);if(null!=t)try{var n,a=JSON.parse(t),r=new Set,s=Object(v["a"])(a);try{for(s.s();!(n=s.n()).done;){var i=n.value,o=i.changedKeys,c=i.repositoryName;if(this.repositoryName===c){var l,u=Object(v["a"])(o);try{for(u.s();!(l=u.n()).done;){var d=l.value;r.add(d)}}catch(p){u.e(p)}finally{u.f()}}}}catch(p){s.e(p)}finally{s.f()}e=r.size>3?"：".concat(Object(y["a"])(r).slice(0,3).join(", "),"等").concat(r.size,"个Key"):"：".concat(Object(y["a"])(r).join(", "))}catch(m){console.error("addMsgForUpdateKey --",m)}this.setCommmitMsg("Key更新".concat(e,"\n"))},addMsgForAddModule:function(){var e="",t=localStorage.getItem(S);if(null!=t)try{var n,a=JSON.parse(t),r=new Set,s=Object(v["a"])(a);try{for(s.s();!(n=s.n()).done;){var i=n.value,o=i.repositoryName,c=i.moduleName;this.repositoryName===o&&r.add(c)}}catch(l){s.e(l)}finally{s.f()}e="：".concat(Object(y["a"])(r).join(", "))}catch(u){console.error("addMsgForAddModule --",this.addMsgForAddModule)}this.setCommmitMsg("新增模块".concat(e,";\n"))},setCommmitMsg:function(e){var t=new RegExp(e,"g");this.commitMsg=this.commitMsg.replace(t,""),this.commitMsg=e+this.commitMsg},clearNotPushInfo:function(){localStorage.setItem(S,"[]"),localStorage.setItem(K,"[]")},addMsgForTest:function(){this.setCommmitMsg("i18n测试")}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.refreshGithubAccessToken();case 2:return t.next=4,e.getGithubUserInfo();case 4:case"end":return t.stop()}}),t)})))()}},x=O,C=(n("37cb"),Object(p["a"])(x,k,w,!1,null,null,null)),_=C.exports,I=function(){var e=this,t=e.$createElement,n=e._self._c||t;return null!=e.repository?n("div",{staticClass:"i18n-management-file-edit-mode"},[n("aside",[n("el-tree",{attrs:{data:e.directoryTree,props:e.defaultProps,"default-expand-all":""},on:{"node-click":e.handleNodeClick}})],1),n("div",{staticClass:"i-m-main-content",class:{comparing:e.isCompareData}},[e.targetJSONString?n("div",{staticClass:"i-m-mc-left-box"},[n("div",{staticClass:"i-m-mc-header"},[n("el-breadcrumb",{attrs:{separator:"/"}},e._l(e.breadcrumbs,(function(t,a){return n("el-breadcrumb-item",{key:"breadcrumb-"+a},[e._v(e._s(t))])})),1),e.isTargetJSONStringChanged?n("el-button",{staticClass:"save-json",attrs:{type:"primary",size:"mini",disabled:""!==e.error1Msg},on:{click:function(t){return e.saveJSONString("targetJSONString")}}},[e._v("保存")]):e._e()],1),n("div",{staticClass:"i-m-mc-code-box"},[n("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.error1Msg,expression:"error1Msg"}],staticStyle:{"margin-bottom":"15px"},attrs:{"show-icon":"",type:"error",title:e.error1Msg},on:{close:function(t){return e.clearErrorMsg("targetJSONString")}}}),n("codemirror",{key:"codeMirror1",ref:"codeMirror1",attrs:{code:e.targetJSONString,options:e.editorOptions},on:{input:e.onTargetCodeChange}})],1)]):e._e(),e.comparedJSONString?n("div",{staticClass:"i-m-mc-right-box"},[n("div",{staticClass:"i-m-mc-header"},[n("el-breadcrumb",{attrs:{separator:"/"}},e._l(e.comparedBreadcrumbs,(function(t,a){return n("el-breadcrumb-item",{key:"breadcrumb-"+a},[e._v(e._s(t))])})),1),e.isComparedJSONStringChanged?n("el-button",{staticClass:"save-json",attrs:{type:"primary",size:"mini",disabled:""!==e.error2Msg},on:{click:function(t){return e.saveJSONString("comparedJSONString")}}},[e._v("保存")]):e._e()],1),n("div",{staticClass:"i-m-mc-code-box"},[n("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.error2Msg,expression:"error2Msg"}],staticStyle:{"margin-bottom":"15px"},attrs:{"show-icon":"",type:"error",title:e.error2Msg},on:{close:function(t){return e.clearErrorMsg("comparedJSONString")}}}),n("codemirror",{key:"codeMirror2",ref:"codeMirror2",attrs:{code:e.comparedJSONString,options:e.editorOptions},on:{input:e.onComparedCodeChange}})],1)]):e._e(),""===e.selectedPath?n("div",{staticClass:"i-m-mc-empty-box"},[e._v(" 请在左侧栏选择文件... ")]):e._e()])]):e._e()},R=[],j=n("5530"),L=n("15fd"),T=(n("4de4"),n("d81d"),n("8f94")),E=(n("a7be"),n("0109"),n("697e"),n("cbc8"),n("4895"),n("a2c1"),n("aedd"),n("8d70"),n("8c33"),n("ba14"),n("23de"),n("b933"),n("d7d5"),{tabSize:4,mode:"text/html",theme:"dracula",lineNumbers:!0,line:!0,extraKeys:{Ctrl:"autocomplete"},lineWrapping:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],styleSelectedText:!0,highlightSelectionMatches:{showToken:/\w/,annotateScrollbar:!0}});n("f9d4");n("b866");var J=n("0f32"),$=null,D={name:"file-edit-mode",components:{codemirror:T["codemirror"]},props:{repository:Object,fetchJSONFileContent:Function},data:function(){return{editorOptions:Object.assign({},E,{mode:{name:"javascript",json:!0},viewportMargin:1/0,gutters:[]}),defaultProps:{children:"children",label:"name"},selectedPath:"",comparedPath:"",targetJSONString:"",isTargetJSONStringChanged:!1,comparedJSONString:"",isComparedJSONStringChanged:!1,breadcrumbs:[],comparedBreadcrumbs:[],isCompareData:!0,validator:{},errorMsgMap:{targetJSONString:"",comparedJSONString:""},error1Msg:"",error2Msg:""}},computed:{repositoryName:function(){return this.repository?this.repository.repositoryName:""},directoryTree:function(){var e=[],t=this.repository?this.repository.directoryTree:[];t=t.filter((function(e){return"module"===e.keysType}));var n,a=Object(v["a"])(t);try{for(a.s();!(n=a.n()).done;){var r=n.value,s=r.children,i=Object(L["a"])(r,["children"]),o=Object(j["a"])({children:[]},i);if(e.push(o),s.length){var c=s[0];if("language"===c.keysType&&c.children.length>0){o.children=c.children;continue}}}}catch(l){a.e(l)}finally{a.f()}return e}},watch:{targetJSONString:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchJSONFileContent(e.selectedPath,e.breadcrumbs);case 2:n=t.sent,e.isTargetJSONStringChanged=e.targetJSONString!==JSON.stringify(n,null,"\t");case 4:case"end":return t.stop()}}),t)})))()},comparedJSONString:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchJSONFileContent(e.comparedPath,e.comparedBreadcrumbs);case 2:n=t.sent,e.isComparedJSONStringChanged=e.comparedJSONString!==JSON.stringify(n,null,"\t");case 4:case"end":return t.stop()}}),t)})))()},"errorMsgMap.targetJSONString":function(){this.error1Msg=this.errorMsgMap.targetJSONString},"errorMsgMap.comparedJSONString":function(){this.error2Msg=this.errorMsgMap.comparedJSONString}},methods:{handleNodeClick:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var a,r,s,i,o,c,l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!e.path){n.next=20;break}return $=e,t.selectedPath=e.path,t.breadcrumbs=e.keys,a="index"!==e.fileName?e.keys:e.keys.slice(0,-1),n.next=7,t.fetchJSONFileContent(e.path,a);case 7:return r=n.sent,t.targetJSONString=JSON.stringify(r,null,"\t"),s=e.language,i="en"===s?"zh-CN":"en",o=e.keys.map((function(e){return e===s?i:e})),c=e.path.replace("/".concat(s,"/"),"/".concat(i,"/")),t.comparedPath=c,t.comparedBreadcrumbs=o,o="index"!==e.fileName?o:o.slice(0,-1),n.next=18,t.fetchJSONFileContent(c,o);case 18:l=n.sent,t.comparedJSONString=JSON.stringify(l,null,"\t");case 20:console.log("item -",e);case 21:case"end":return n.stop()}}),n)})))()},saveJSONString:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var a,r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:n.t0=e,n.next="targetJSONString"===n.t0?3:"comparedJSONString"===n.t0?8:13;break;case 3:if(""===t.error1Msg){n.next=5;break}return n.abrupt("return");case 5:return a=t.selectedPath,r=t.targetJSONString,n.abrupt("break",14);case 8:if(""===t.error2Msg){n.next=10;break}return n.abrupt("return");case 10:return a=t.comparedPath,r=t.comparedJSONString,n.abrupt("break",14);case 13:return n.abrupt("return");case 14:return n.next=16,window.fetch("//i18n-ts.testfreelog.com/v1/i18nRepository/data",{method:"PUT",headers:{"Content-Type":"application/json"},body:{repositoryName:t.repositoryName,changedFiles:[{targetPath:a,targetJSONString:r}]}}).then((function(e){return e.json()}));case 16:s=n.sent,0===s.errcode?(t.$emit("update-repository-changes",s.data),t.$message.success("保存成功！"),t.$emit("update-cache-JSONString",{path:a,value:JSON.parse(r)})):t.$message.error("保存失败！");case 18:case"end":return n.stop()}}),n)})))()},onTargetCodeChange:function(e){this.changeJSONString("targetJSONString",e)},onComparedCodeChange:function(e){this.changeJSONString("comparedJSONString",e)},changeJSONString:function(e,t){var n=this;this[e]=t;var a=this.validator[e];a?a():this.validator[e]=J((function(){n.validateJSON(e)}),2e3),this.$emit("input",this[e])},validateJSON:function(e){try{JSON.parse(this[e]),this.clearErrorMsg(e)}catch(t){this.errorMsgMap[e]="".concat(this.$t("metaInput.metaJSONError"),"！").concat(t)}this.$emit("validate",this.errorMsgMap[e])},clearErrorMsg:function(e){this.errorMsgMap[e]=""}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(console.log("lastSelectedTreeData --",$),null==$){t.next=4;break}return t.next=4,e.handleNodeClick($);case 4:case"end":return t.stop()}}),t)})))()}},V=D,A=(n("7fce"),n("498c"),Object(p["a"])(V,I,R,!1,null,"5896519e",null)),P=A.exports,U=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"i18n-m-namespace-edit-mode"},[n("div",{staticClass:"i-m-nem-head"},[n("div",{staticClass:"module-select-box"},[n("label",{attrs:{for:"module-select"}},[e._v("模块名称：")]),n("el-select",{attrs:{size:"small",id:"module-select",value:e.selectedModuleName},on:{change:e.exchangeModuleName}},[n("el-option",{attrs:{label:e.allModuleLabel,value:e.ALL_MODULES}}),e._l(e.reposModules,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}))],2)],1),n("div",{staticClass:"state-select-box"},[n("label",{attrs:{for:"state-select"}},[e._v("状态：")]),n("el-select",{attrs:{size:"small",id:"state-select",value:e.selectedState},on:{change:e.exchangeState}},e._l(e.keyStates,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("el-input",{staticClass:"module-search-input",attrs:{size:"small",type:"text","suffix-icon":"el-icon-search",placeholder:"请输入内容进行Key筛选"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.refreshSidebar(t)}},model:{value:e.searchInputStr,callback:function(t){e.searchInputStr=t},expression:"searchInputStr"}}),""!=e.selectedTag?n("div",{staticClass:"selected-tag-box"},[n("label",{attrs:{for:"tags-select"}},[e._v("筛选标签：")]),e.selectedTagInputVisible?n("el-input",{ref:"selectedTagInput",staticClass:"selected-tag-input",attrs:{size:"small"},on:{blur:e.handleTagInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleTagInputConfirm(t)}},model:{value:e.selectedTagInputVal,callback:function(t){e.selectedTagInputVal=t},expression:"selectedTagInputVal"}}):n("el-tag",{attrs:{size:"small",closable:""},on:{close:function(t){e.selectedTag=""},click:e.showSelectedTagInput}},[e._v(e._s(e.selectedTag))])],1):e._e(),n("el-badge",{staticClass:"save-key-changes-btn",attrs:{slot:"reference",value:e.changedKeys.length,hidden:0===e.changedKeys.length},slot:"reference"},[n("el-button",{attrs:{type:"primary",size:"small",disabled:0===e.changedKeys.length},on:{click:e.saveChanges}},[e._v(" 保存"),n("span",[e._v("（共"+e._s(e.changedKeys.length)+"个Key更改）")])])],1),n("el-button",{staticClass:"add-new-namescpace-btn",attrs:{type:"danger",size:"small"},on:{click:e.showNewKeyDialog}},[e._v("新增Key")]),n("el-button",{staticClass:"add-new-module-btn",attrs:{type:"danger",size:"small"},on:{click:function(t){e.newModuleDialogVisible=!0}}},[e._v("新增模块")])],1),n("namespace-sidebar",{attrs:{refresSidebarCount:e.refresSidebarCount,selectedModuleName:e.selectedModuleName,repositoryName:e.repositoryName,searchInputStr:e.searchInputStr,selectedState:e.selectedState,filteredKeyInfos:e.filteredKeyInfos,reposModules:e.reposModules,languages:e.languages,reposModulesMap:e.reposModulesMap,changedKeysMap:e.changedKeysMap,selectedKeyItem:e.selectedKeyItem,allModuleData:e.allModuleData},on:{"update:refresSidebarCount":function(t){e.refresSidebarCount=t},"update:refres-sidebar-count":function(t){e.refresSidebarCount=t},"update:selectedKeyItem":function(t){e.selectedKeyItem=t},"update:selected-key-item":function(t){e.selectedKeyItem=t}}}),null!=e.selectedKeyItem?n("div",{staticClass:"i-m-nem-body"},[n("div",{staticClass:"i-m-nem-breadcrumb-box"},[null!=e.selectedRepoModule?n("el-breadcrumb",{attrs:{separator:"/"}},e._l(e.selectedRepoModule.keys,(function(t,a){return n("el-breadcrumb-item",{key:"breadcrumb-"+a},[e._v(e._s(t))])})),1):e._e(),n("span",{staticClass:"i-m-nem-selected-key"},[e._v(e._s(e.selectedKeyItem.key))]),n("clipboard",{attrs:{value:e.selectedKeyItem.key}},[n("el-button",{staticClass:"i-m-nem-key-copy",attrs:{type:"primary",size:"mini",plain:""}},[e._v("copy")])],1)],1),n("key-tags",{attrs:{languages:e.languages,repositoryName:e.repositoryName,selectedTag:e.selectedTag,selectedKeyItem:e.selectedKeyItem,keyInfo:e.selectedKeyInfo},on:{"update:selectedTag":function(t){e.selectedTag=t},"update:selected-tag":function(t){e.selectedTag=t},"update:keyInfo":function(t){e.selectedKeyInfo=t},"update:key-info":function(t){e.selectedKeyInfo=t}}}),n("div",{staticClass:"clearfix"},e._l(e.languages,(function(t){return n("namespace-card",{key:t,attrs:{language:t,languages:e.languages,title:e.languagesMap[t],selectedKeyItem:e.selectedKeyItem},on:{"value-update":e.handleChanges}})})),1)],1):n("div",{staticClass:"i-m-nem-empty"},[e.selectedModuleName!==e.ALL_MODULES&&!0===e.selectedModuleIsEmpty?n("div",{staticClass:"empty-module-box"},[n("el-button",{staticClass:"add-del-module-btn",attrs:{type:"danger",size:"small"},on:{click:e.delEmptyModule}},[e._v("删除"+e._s(e.selectedModuleName)+"模块")]),n("p",[e._v("当前模块为空（没有任何Key）")])],1):n("div",[e._v("暂无符合的Keys...")])]),n("el-dialog",{staticClass:"i-m-nem-add-dialog",attrs:{title:"新增Key",width:"480px",center:"","close-on-click-modal":!1,visible:e.newKeyDialogVisible},on:{"update:visible":function(t){e.newKeyDialogVisible=t}}},[n("div",{staticClass:"module-select-box"},[n("label",[e._v("Key的所属模块：")]),n("el-select",{attrs:{size:"small",id:"module-select",placeholder:"请选择模块"},model:{value:e.newKeyOfModuleName,callback:function(t){e.newKeyOfModuleName=t},expression:"newKeyOfModuleName"}},e._l(e.reposModules,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1),n("el-input",{attrs:{placeholder:"输入key"},on:{input:e.validateNewKey},model:{value:e.newKey,callback:function(t){e.newKey=t},expression:"newKey"}}),n("p",{staticClass:"add-key-error"},[e._v(e._s(e.newKeyValidtedError))]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.newKeyDialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary",size:"small",disabled:""!==e.newKeyValidtedError||""==e.newKeyOfModuleName},on:{click:e.addNewKey}},[e._v("确 定 ")])],1)],1),n("el-dialog",{staticClass:"i-m-nem-add-dialog",attrs:{title:"新增模块",width:"480px",center:"","close-on-click-modal":!1,visible:e.newModuleDialogVisible},on:{"update:visible":function(t){e.newModuleDialogVisible=t}}},[n("el-input",{attrs:{placeholder:"输入模块名称"},on:{input:e.validateNewModule},model:{value:e.newModule,callback:function(t){e.newModule=t},expression:"newModule"}}),n("p",{staticClass:"add-key-error"},[e._v(e._s(e.newModuleValidtedError))]),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{size:"small"},on:{click:function(t){e.newModuleDialogVisible=!1}}},[e._v("取 消")]),n("el-button",{attrs:{type:"primary",size:"small",disabled:""!=e.newModuleValidtedError},on:{click:e.addNewModule}},[e._v("确 定")])],1)],1)],1)},z=[],F=(n("159b"),n("07ac"),n("b64b"),n("a434"),n("1276"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-card",{staticClass:"i-m-nem-edit-item"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[n("span",{staticClass:"i-m-nem-title"},[e._v(e._s(e.title))])]),n("div",["string"===e.selectedKeyItem.valueType?n("el-input",{attrs:{type:"textarea",rows:"4"},on:{input:e.handleNamespaceInput,change:e.handleNamespaceChange},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}}):e._l(e.value,(function(t,a){return n("el-input",{key:"val-"+a,staticStyle:{"margin-bottom":"10px"},attrs:{type:"textarea",rows:"3"},on:{change:e.handleNamespaceChange},model:{value:e.value[a],callback:function(t){e.$set(e.value,a,t)},expression:"value[i]"}},[n("template",{slot:"prepend"},[e._v(e._s(a))])],2)}))],2)])}),B=[],G=n("3835"),H=(n("4fad"),{data:function(){return{topedLanguage:"zh-CN"}},methods:{getModuleI18nData:function(e,t,n){return null!=e?M.a.get(e,[t,n]):null},getModuleI18nKeysList:function(e,t){if(null==t)return[];var n=this.topedLanguage||"zh-CN";return this.getKeysListFromI18nData(t[n],e)},getKeysListFromI18nData:function(e,t){var n=this,a=[];if(null==e)return a;for(var r=function(){var e=Object(G["a"])(i[s],2),r=e[0],o=e[1];if(Array.isArray(o))a.push({key:r,value:o,moduleName:t,valueType:"array"});else if("string"===typeof o)a.push({key:r,value:o,moduleName:t,valueType:"string"});else{var c=n.getKeysListFromI18nData(o,t).map((function(e){return e.key="".concat(r,".").concat(e.key),e}));a.push.apply(a,Object(y["a"])(c))}},s=0,i=Object.entries(e);s<i.length;s++)r();return a},formatKeysList:function(e,t){var n=this;if(null!=e&&null!=t&&null!=this.languages){var a=this.languages.filter((function(e){return e!==n.topedLanguage}));return t=t.map((function(t){t[n.topedLanguage]=t.value;for(var r=0;r<a.length;r++){var s=a[r];t[s]=M.a.get(e,"".concat(s,".").concat(t.key))}return t.tags=[],t})),t}},checkLanguageValue:function(e){var t=!1;return this.languages.forEach((function(n){t=t||!e[n]})),e.isExistEmptyValue=t,e}}}),q={name:"i18n-namespace-card",props:{language:String,languages:Array,title:String,selectedKeyItem:Object},mixins:[H],data:function(){return{value:""}},watch:{selectedKeyItem:function(){this.value=this.selectedKeyItem[this.language]}},methods:{handleNamespaceInput:function(e){this.selectedKeyItem[this.language]=e},handleNamespaceChange:function(){this.checkLanguageValue(this.selectedKeyItem);var e=Object.assign({operation:"update"},this.selectedKeyItem);this.$emit("value-update",e)}},mounted:function(){this.value=this.selectedKeyItem[this.language]}},W=q,Y=(n("9f51"),Object(p["a"])(W,F,B,!1,null,"b6e24a7e",null)),Q=Y.exports,X=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"i-nem-edit-key-tags"},[e._l(e.tags,(function(t){return n("el-tag",{key:t,attrs:{size:e.size,closable:"","disable-transitions":!1},on:{click:function(n){return e.selectTag(t)},close:function(n){return e.handleClose(t)}}},[e._v(" "+e._s(t)+" ")])})),e.addBtnVisible?[e.inputVisible?n("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:e.size},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):n("el-button",{staticClass:"button-new-tag",attrs:{size:e.size},on:{click:e.showInput}},[e._v("+ 新增标签")])]:e._e()],2)},Z=[],ee={name:"key-tags",components:{},props:{size:{type:String,default:"small"},repositoryName:String,selectedTag:String,selectedKeyItem:Object,keyInfo:Object,languages:Array,addBtnVisible:{type:Boolean,default:!0}},data:function(){return{tags:[],inputValue:"",inputVisible:!1}},computed:{moduleName:function(){return null!=this.selectedKeyItem?this.selectedKeyItem.moduleName:""},keyName:function(){return null!=this.selectedKeyItem?this.selectedKeyItem.key:""},values:function(){var e=this;return this.languages.map((function(t){var n=e.selectedKeyItem[t];return{lang:t,value:n}}))}},watch:{keyInfo:function(){this.resolveKeyInfo()}},methods:{handleClose:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var a,r,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.tags.indexOf(e),r=t.tags.slice(),r.splice(a,1),n.next=5,t.updateKeyInfo(r);case 5:s=n.sent,0===s.errcode?(t.tags.splice(a,1),t.$message.success("删除tag（".concat(e,"）成功！"))):t.$message.error("删除tag（".concat(e,"）失败: ").concat(s.msg));case 7:case"end":return n.stop()}}),n)})))()},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.inputValue,!n){t.next=11;break}if(-1===e.tags.indexOf(n)){t.next=5;break}return e.$message.error("tag（".concat(n,"）已存在！")),t.abrupt("return");case 5:return a=e.tags.slice(),a.push(n),t.next=9,e.updateKeyInfo(a);case 9:r=t.sent,0===r.errcode?(e.tags.push(n),e.$message.success("新增tag（".concat(n,"）成功！"))):e.$message.error("新增tag（".concat(n,"）失败: ").concat(r.msg));case 11:e.inputVisible=!1,e.inputValue="";case 13:case"end":return t.stop()}}),t)})))()},updateKeyInfo:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){var a,r;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a={name:t.keyName,moduleName:t.moduleName,repositoryName:t.repositoryName,description:"",tags:e,values:t.values},n.next=3,window.fetch("//i18n-ts.testfreelog.com/v1/i18nKeyInfos",{method:null!=t.keyInfo?"PUT":"POST",body:a}).then((function(e){return e.json()})).catch((function(e){return e}));case 3:if(r=n.sent,!(r instanceof Error)){n.next=8;break}return n.abrupt("return",null);case 8:return n.abrupt("return",r);case 9:case"end":return n.stop()}}),n)})))()},selectTag:function(e){this.$emit("update:selectedTag",e)},resolveKeyInfo:function(){var e=[];null!=this.keyInfo&&(e=this.keyInfo.tags),this.tags=e}},mounted:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.resolveKeyInfo();case 1:case"end":return t.stop()}}),t)})))()}},te=ee,ne=(n("87fb"),Object(p["a"])(te,X,Z,!1,null,null,null)),ae=ne.exports,re=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{on:{click:e.copyHandler}},[n("textarea",{ref:"copyText",staticClass:"clip-text",domProps:{value:e.value}}),e._t("default")],2)},se=[],ie={name:"clip-board",data:function(){return{}},props:{value:String},mounted:function(){},methods:{copyHandler:function(){var e=this.$refs.copyText;e.select();try{var t=document.execCommand("copy");this.$emit("copyDone",t)}catch(n){this.$emit("copyDone",!1)}}}},oe=ie,ce=(n("bd42"),Object(p["a"])(oe,re,se,!1,null,"23372bd1",null)),le=ce.exports,ue=function(){var e=this,t=e.$createElement,n=e._self._c||t;return 0!==e.renderedKeysMap.size?n("div",{staticClass:"i-m-nem-sidebar"},[e.selectedModuleName===e.nameOfAllModule?n("div",[n("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.reposModules,(function(t){return n("el-collapse-item",{directives:[{name:"show",rawName:"v-show",value:null!=e.renderedKeysListMap[t.name]&&e.renderedKeysListMap[t.name].length,expression:"renderedKeysListMap[_module.name] != null && renderedKeysListMap[_module.name].length"}],key:t.name,attrs:{title:t.name,name:t.name}},[null!=e.renderedKeysListMap[t.name]?n("ul",e._l(e.renderedKeysListMap[t.name],(function(a,r){return n("li",{key:a.key+r,class:{active:a.key===e.selectedKeyItem.key&&e.selectedKeyItem.moduleName===t.name},on:{click:function(t){return e.handleSelectKey(a)}}},[e.changedKeysMap[a.key]&&e.changedKeysMap[a.key].moduleName===t.name?n("span",{staticClass:"change-badge"},[e._v(" "+e._s(e.badgeMap[e.changedKeysMap[a.key].operation])+" ")]):e._e(),a.isExistEmptyValue?n("span",{staticClass:"empty-value"},[e._v("空")]):e._e(),e._v(" "+e._s(a.key)+" ")])})),0):e._e()])})),1)],1):n("ul",e._l(e.selectedModuleKeysList,(function(t,a){return n("li",{key:t.key+a,class:{active:t.key===e.selectedKeyItem.key},on:{click:function(n){return e.handleSelectKey(t)}}},[e.changedKeysMap[t.key]?n("span",{staticClass:"change-badge"},[e._v(e._s(e.badgeMap[e.changedKeysMap[t.key].operation]))]):e._e(),t.isExistEmptyValue?n("span",{staticClass:"empty-value"},[e._v("空")]):e._e(),e._v(" "+e._s(t.key)+" ")])})),0)]):e._e()},de=[],pe=(n("a9e3"),n("4ec9"),{name:"namespace-sidebar",props:{refresSidebarCount:Number,repositoryName:String,selectedModuleName:String,searchInputStr:String,selectedState:String,selectedTag:String,reposModules:{type:Array,default:function(){return[]}},languages:{type:Array,default:function(){return[]}},filteredKeyInfos:{type:Array,default:function(){return[]}},selectedKeyItem:Object,reposModulesMap:Object,changedKeysMap:Object,allModuleData:Object},mixins:[H],data:function(){return{nameOfAllModule:N,badgeMap:{update:"改",add:"增",delete:"删"},activeNames:[],selectedModuleKeysList:[],filteredKeyInfosMap:new Map,renderedKeysListMap:{},renderedKeysMap:new Map}},watch:{refresSidebarCount:function(){this.refreshKeysList(),this.refreshSelectedKeyItem(),this.activeNames=this.reposModules.map((function(e){return e.name}))},filteredKeyInfos:function(){var e=this;this.filteredKeyInfosMap=new Map,""!==this.selectedTag&&this.filteredKeyInfos.forEach((function(t){return e.filteredKeyInfosMap.set(t.name,t),t})),this.$emit("update:refresSidebarCount",this.refresSidebarCount+1)}},methods:{handleSelectKey:function(e){this.$emit("update:selectedKeyItem",e)},refreshSelectedKeyItem:function(){var e;if(this.selectedModuleName!==this.nameOfAllModule)this.selectedModuleKeysList=this.renderedKeysListMap[this.selectedModuleName],e=this.selectedModuleKeysList;else{var t,n=Object(v["a"])(this.reposModules);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=this.renderedKeysListMap[a.name];if(r.length>0){e=r;break}}}catch(s){n.e(s)}finally{n.f()}}1!==this.renderedKeysMap.get(this.getUniqueKey(this.selectedKeyItem))&&(null!=e&&e.length?this.handleSelectKey(e[0]):this.handleSelectKey(null))},refreshKeysList:function(){console.log("[refreshKeysList]"),this.selectedModuleName===N?this.refreshRenderedKeysListMap(this.reposModules.map((function(e){return e.name}))):this.refreshRenderedKeysListMap([this.selectedModuleName])},refreshRenderedKeysListMap:function(e){var t,n=Object(v["a"])(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=this.getModuleI18nData(this.allModuleData,this.repositoryName,a),s=this.getModuleI18nKeysList(a,r);s=this.formatKeysList(r,s),s=this.filterKeysList(s),s=this.rearrangeKeysList(s),this.renderedKeysListMap[a]=s}}catch(i){n.e(i)}finally{n.f()}this.collectRenderedKey(e)},rearrangeKeysList:function(e){var t=this,n=[];e=e.filter((function(e){var a=t.changedKeysMap[e.key];return null==a||a.moduleName!==e.moduleName||(n.push(a),!1)})),e=e.filter((function(e){return!e.isExistEmptyValue||(n.push(e),!1)}));for(var a=0,r=n;a<r.length;a++){var s=r[a];e.unshift(s)}return e},filterKeysList:function(e){var t=this,n=this.searchInputStr.replace(/^(\s*)|(\s*)$/g,"").toLowerCase();return e.map((function(e){return t.checkLanguageValue(e)})).filter((function(e){var a=-1!==e.key.toLowerCase().indexOf(n);switch(t.languages.forEach((function(t){if(null!=e[t]){var r=e[t];Array.isArray(e[t])&&(r=e[t].join("")),a=a||-1!==r.toLowerCase().indexOf(n)}})),t.selectedState){case"update":a=a&&!!t.changedKeysMap[e.key];break;case"empty":a=a&&e.isExistEmptyValue;break;case"all":break;default:break}return a})).filter((function(e){if(0===t.filteredKeyInfos.length)return!0;var n=t.filteredKeyInfosMap.get(e.key);return null!=n&&n.moduleName===e.moduleName}))},collectRenderedKey:function(e){var t,n=new Map,a=Object(v["a"])(e);try{for(a.s();!(t=a.n()).done;){var r,s=t.value,i=this.renderedKeysListMap[s],o=Object(v["a"])(i);try{for(o.s();!(r=o.n()).done;){var c=r.value,l=this.getUniqueKey(c);n.set(l,1)}}catch(u){o.e(u)}finally{o.f()}}}catch(u){a.e(u)}finally{a.f()}this.renderedKeysMap=n},getUniqueKey:function(e){return null!=e?"".concat(e.moduleName,"||").concat(e.key):""}},mounted:function(){}}),me=pe,he=(n("5b64"),Object(p["a"])(me,ue,de,!1,null,null,null)),fe=he.exports,ge={name:"namespace-edit-mode",components:{NamespaceCard:Q,KeyTags:ae,Clipboard:le,NamespaceSidebar:fe},mixins:[H],props:{languages:Array,repository:Object,allModuleData:Object},data:function(){return{ALL_MODULES:N,allModuleLabel:"全部模块",languagesMap:{en:"英文","en-US":"英文","zh-CN":"中文"},isRefreshingSidebar:!1,searchInputStr:"",selectedRepoModule:null,selectedModuleName:"",filteredNamespaceList:[],renderedKeysListMap:{},selectedKeyItem:null,selectedKeyInfo:null,newKeyDialogVisible:!1,newKey:"",newKeyOfModuleName:"",timer:null,newKeyValidtedError:"",newModuleDialogVisible:!1,newModule:"",newModuleValidtedError:"",changedKeys:[],keyStates:[{label:"全部",value:"all"},{label:"已更新",value:"update"},{label:"存在空值",value:"empty"}],selectedState:"all",refresSidebarCount:0,selectedModuleIsEmpty:!1,filteredKeyInfos:[],selectedTag:"",selectedTagInputVal:"",selectedTagInputVisible:!1}},computed:{repositoryName:function(){return this.repository.repositoryName},reposModules:function(){return this.repository.directoryTree},reposModulesMap:function(){var e={};return this.repository.directoryTree.forEach((function(t){e[t.name]=t})),e},changedKeysMap:function(){var e={};return this.changedKeys.forEach((function(t){e[t.key]=t})),e}},watch:{selectedModuleName:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.searchInputStr="",e.refreshSidebar(),e.checkModuleIsEmpty();case 3:case"end":return t.stop()}}),t)})))()},selectedKeyItem:function(){null!=this.selectedKeyItem&&(console.log(),this.selectedRepoModule=this.reposModulesMap[this.selectedKeyItem.moduleName],this.getKeyInfo())},selectedTag:function(){var e=this;this.filteredKeyInfos=[],""!==this.selectedTag&&window.fetch("//i18n-ts.testfreelog.com/v1/i18nKeyInfos/list?tags=".concat(this.selectedTag)).then((function(e){return e.json()})).then((function(t){0===t.errcode&&(e.filteredKeyInfos=null!=t.data?t.data:[])}))},allModuleData:function(){this.refreshSidebar(),this.exchangeModuleName(this.ALL_MODULES)}},methods:{init:function(){this.reposModules&&(this.setTopForLanguage(this.topedLanguage),this.exchangeModuleName(this.ALL_MODULES))},refreshSidebar:function(){this.refresSidebarCount=this.refresSidebarCount+1},checkModuleIsEmpty:function(){if(this.selectedModuleName===N)this.selectedModuleIsEmpty=!1;else{var e=this._getModuleI18nData(this.selectedModuleName),t=Object.values(e),n=Object.keys(t[0]||{});this.selectedModuleIsEmpty=0===n.length}},setTopForLanguage:function(e){var t=this.languages.indexOf(e);-1!==t&&(this.languages.splice(t,1),this.languages.unshift(e))},exchangeModuleName:function(e){this.selectedModuleName=e},_getModuleI18nData:function(e){return this.getModuleI18nData(this.allModuleData,this.repositoryName,e)},exchangeState:function(e){this.selectedState=e,this.refreshSidebar()},showNewKeyDialog:function(){this.newKeyDialogVisible=!0,this.selectedModuleName===N?this.newKeyOfModuleName="":this.newKeyOfModuleName=this.selectedModuleName},validateNewKey:function(e){var t=this;clearTimeout(this.timer),this.timer=setTimeout((function(){if(e=e.replace(/^(\s*)|(\s*)$/g,""),""!==e){var n=/^[_-\w\d\.]+$/.test(e);n?t.isKeyExisted(e)?t.newKeyValidtedError="命名冲突： 输入的key已存在！":t.newKeyValidtedError="":t.newKeyValidtedError="命名格式有误; key由大小字母、数字和字符（_、-、.）组合而成"}else t.newKeyValidtedError="命名格式有误; key不能为空"}),50)},isKeyExisted:function(e){if(null!=this.changedKeysMap[e])return!0;var t,n=Object(v["a"])(this.reposModules);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=this._getModuleI18nData(a.name);if(null!=r&&null!=M.a.get(r["zh-CN"],e))return!0}}catch(s){n.e(s)}finally{n.f()}return!1},addNewKey:function(){""===this.newKeyValidtedError&&(this.handleChanges({moduleName:this.newKeyOfModuleName,operation:"add",key:this.newKey,valueType:"string",en:"","zh-CN":""}),this.newKeyDialogVisible=!1,this.newKey="",this.checkModuleIsEmpty())},handleChanges:function(e){for(var t=e.key,n=e.operation,a=e.moduleName,r=this.changedKeys,s=-1,i=0;i<r.length;i++)if(r[i].key===t&&r[i].moduleName===a){s=i;break}switch(n){case"update":-1!==s&&r.splice(s,1),r.unshift(e);var o,c=this._getModuleI18nData(a),l=Object(v["a"])(this.languages);try{for(l.s();!(o=l.n()).done;){var u=o.value;M.a.set(c,"".concat(u,".").concat(t),e[u])}}catch(f){l.e(f)}finally{l.f()}break;case"delete":-1!==s&&r.splice(s,1),r.unshift(e);break;case"add":r.unshift(e);var d,p=this._getModuleI18nData(a),m=Object(v["a"])(this.languages);try{for(m.s();!(d=m.n()).done;){var h=d.value;M.a.set(p,"".concat(h,".").concat(t),"")}}catch(f){m.e(f)}finally{m.f()}this.refreshSidebar();break}},validateNewModule:function(e){var t=this;clearTimeout(this.timer),this.timer=setTimeout((function(){if(e=e.replace(/^(\s*)|(\s*)$/g,""),""!==e){var n=/^[-\w]+$/.test(e);n?null==M.a.get(t.allModuleData,[t.selectedReposName,e])?t.newModuleValidtedError="":t.newModuleValidtedError="模块名称冲突： 输入的模块名称已存在！":t.newModuleValidtedError="模块名称有误；由大小字母和字符（-）组合而成"}else t.newModuleValidtedError="模块名称不能为空"}),50)},addNewModule:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.newModule.replace(/^(\s*)|(\s*)$/g,""),""===n){t.next=8;break}return a=e.repositoryName,t.next=5,window.fetch("//i18n-ts.testfreelog.com/v1/i18nRepository/newModule",{method:"POST",body:{moduleName:n,repositoryName:a,languages:["zh-CN","en"]}}).then((function(e){return e.json()}));case 5:r=t.sent,0===r.errcode?(e.$emit("add-module-success",n,r.data),e.selectedModuleName=n,e.saveModuleHandlerRecord(n,a,"add"),e.$message.success("模块 ".concat(n," 创建成功！"))):e.$message.error(r.msg),e.newModuleDialogVisible=!1;case 8:case"end":return t.stop()}}),t)})))()},delEmptyModule:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,n=e.selectedModuleName,t.next=4,e.$confirm("当前操作将会删除模块".concat(n,"，是否继续？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});case 4:return a=e.repositoryName,t.next=7,window.fetch("//i18n-ts.testfreelog.com/v1/i18nRepository/module",{method:"DELETE",body:{moduleName:n,repositoryName:a}}).then((function(e){return e.json()}));case 7:r=t.sent,0===r.errcode?(e.$emit("del-module-success",n,r.data),e.saveModuleHandlerRecord(n,a,"delete"),e.exchangeModuleName(e.ALL_MODULES),e.$message.success("模块 ".concat(n," 删除成功！"))):e.$message.error(r.msg),t.next=15;break;case 11:return t.prev=11,t.t0=t["catch"](0),console.error(t.t0),t.abrupt("return");case 15:case"end":return t.stop()}}),t,null,[[0,11]])})))()},saveModuleHandlerRecord:function(e,t,n){var a=localStorage.getItem(S)||"[]";a=JSON.parse(a),"add"===n?a.push({moduleName:e,repositoryName:t}):a=a.filter((function(n){return n.repositoryName!==t||n.moduleName!==e})),localStorage.setItem(S,JSON.stringify(a))},saveChanges:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.resolveSaveData(),t.next=3,window.fetch("//i18n-ts.testfreelog.com/v1/i18nRepository/data",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){return e.json()}));case 3:a=t.sent,0===a.errcode?(e.$message.success("保存成功！"),e.saveChangedKeysRecord(e.repositoryName,e.changedKeys),e.changedKeys=[],e.$emit("update-repository-changes",a.data),n.changedFiles.forEach((function(t){e.$emit("update-cache-JSONString",{path:t.targetPath,value:JSON.parse(t.targetJSONString)})}))):e.$message.error("保存失败！".concat(a.msg));case 5:case"end":return t.stop()}}),t)})))()},resolveSaveData:function(){var e,t=[],n=this.changedKeys,a=new Set,r=new Set,s=Object(v["a"])(n);try{for(s.s();!(e=s.n()).done;){var i=e.value,o=i.key,c=i.moduleName,l=this._getModuleI18nData(c),u=this.isMultifileStructure(c);if(u){var d=o.split(".");r.add(d[0])}var p,m=Object(v["a"])(this.languages);try{for(m.s();!(p=m.n()).done;){var h=p.value;M.a.set(l[h],o,i[h])}}catch(L){m.e(L)}finally{m.f()}a.add(c)}}catch(L){s.e(L)}finally{s.f()}var f,g=Object(v["a"])(a);try{for(g.s();!(f=g.n()).done;){var y=f.value,b=this.reposModulesMap[y],k=this._getModuleI18nData(y),w=this.isMultifileStructure(y);if(w){var N,S=Object(v["a"])(r);try{for(S.s();!(N=S.n()).done;){var K,O=N.value,x=Object(v["a"])(this.languages);try{for(x.s();!(K=x.n()).done;){var C=K.value,_=M.a.get(k,[C,O]);t.push({targetJSONString:JSON.stringify(_,null,"\t"),targetPath:[b.path,C,"".concat(O,".json")].join("/")})}}catch(L){x.e(L)}finally{x.f()}}}catch(L){S.e(L)}finally{S.f()}}else{var I,R=Object(v["a"])(this.languages);try{for(R.s();!(I=R.n()).done;){var j=I.value;t.push({targetJSONString:JSON.stringify(k[j],null,"\t"),targetPath:[b.path,j,"index.json"].join("/")})}}catch(L){R.e(L)}finally{R.f()}}}}catch(L){g.e(L)}finally{g.f()}return{repositoryName:this.repositoryName,changedFiles:t}},isMultifileStructure:function(e){var t=this.reposModulesMap[e];return null!==t&&t.children[0].children.length>1},saveChangedKeysRecord:function(e,t){var n=localStorage.getItem(K)||"[]";n=JSON.parse(n),n.push({changedKeys:t.map((function(e){return e.key})),repositoryName:e}),localStorage.setItem(K,JSON.stringify(n))},showSelectedTagInput:function(){var e=this;this.selectedTagInputVisible=!0,this.selectedTagInputVal=this.selectedTag,this.$nextTick((function(){e.$refs.selectedTagInput.$refs.input.focus()}))},handleTagInputConfirm:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.selectedTagInputVal.replace(/^(\s*)|(\s*)$/g,""),""===n){t.next=33;break}return a={repositoryName:e.repositoryName,selectedTag:e.selectedTag,newTag:n},t.next=5,window.fetch("//i18n-ts.testfreelog.com/v1/i18nKeyInfos/tags",{method:"PUT",body:a}).then((function(e){return e.json()})).catch((function(e){return e}));case 5:if(r=t.sent,!(r instanceof Error)){t.next=10;break}e.$message.error(r),t.next=33;break;case 10:if(0!==r.errcode||null==r.data){t.next=32;break}e.$message.success("标签修改成功！"),s=Object(v["a"])(r.data),t.prev=13,s.s();case 15:if((i=s.n()).done){t.next=22;break}if(o=i.value,o.name!==e.selectedKeyItem.key){t.next=20;break}return e.selectedKeyInfo=o,t.abrupt("break",22);case 20:t.next=15;break;case 22:t.next=27;break;case 24:t.prev=24,t.t0=t["catch"](13),s.e(t.t0);case 27:return t.prev=27,s.f(),t.finish(27);case 30:t.next=33;break;case 32:e.$message.error("标签修改失败！".concat(r.msg));case 33:e.selectedTagInputVisible=!1,e.selectedTagInputVal="",e.selectedTag=n;case 36:case"end":return t.stop()}}),t,null,[[13,24,27,30]])})))()},getKeyInfo:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.selectedKeyItem,a=n.key,r=n.moduleName,s=e.repositoryName,i="//i18n-ts.testfreelog.com/v1/i18nKeyInfos?name=".concat(a,"&moduleName=").concat(r,"&repositoryName=").concat(s),t.next=5,window.fetch(i).then((function(e){return e.json()}));case 5:o=t.sent,0===o.errcode&&(e.selectedKeyInfo=o.data);case 7:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.init()}},ye=ge,ve=(n("589d"),Object(p["a"])(ye,U,z,!1,null,null,null)),be=ve.exports,Me=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"i-m-nem-tags-view"},[n("div",{staticClass:"i-m-nem__header clearfix"},[n("div",{staticClass:"module-select-box"},[n("label",{attrs:{for:"module-select"}},[e._v("模块名称：")]),n("el-select",{attrs:{size:"small",id:"module-select",value:e.selectedModuleName},on:{change:e.exchangeModuleName}},[n("el-option",{attrs:{label:e.allModuleLabel,value:e.ALL_MODULES}}),e._l(e.reposModules,(function(e){return n("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}))],2)],1),n("el-input",{staticClass:"filter-search-input",attrs:{type:"text",size:"small","suffix-icon":"el-icon-search",placeholder:"请输入内容进行Key筛选"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.refreshRenderedKeysListMap(t)}},model:{value:e.searchInputStr,callback:function(t){e.searchInputStr=t},expression:"searchInputStr"}}),n("div",{staticClass:"tag-input-box"},[n("el-input",{staticClass:"tag-input",attrs:{type:"text",size:"small",placeholder:"请输入tag"},model:{value:e.tagStr,callback:function(t){e.tagStr=t},expression:"tagStr"}},[n("el-button",{attrs:{slot:"append",type:"primary",icon:"el-icon-plus"},on:{click:e.batchAddTag},slot:"append"},[e._v("添加tag")])],1)],1)],1),e.selectedModuleName===e.ALL_MODULES?n("div",[null!=e.renderedKeysListMap?n("el-collapse",{model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.reposModules,(function(t,a){return n("el-collapse-item",{directives:[{name:"show",rawName:"v-show",value:null!=e.renderedKeysListMap[t.name]&&e.renderedKeysListMap[t.name].length,expression:"renderedKeysListMap[_module.name] != null && renderedKeysListMap[_module.name].length"}],key:t.name,attrs:{title:t.name,name:t.name}},[null!=e.renderedKeysListMap?n("el-checkbox-group",{staticClass:"i-m-nem-tags-checkbox-group clearfix",on:{change:e.onCheckedKeyListChange},model:{value:e.checkedKeyListArr[a],callback:function(t){e.$set(e.checkedKeyListArr,a,t)},expression:"checkedKeyListArr[i]"}},e._l(e.renderedKeysListMap[t.name],(function(t,a){return n("el-col",{key:t.key+a,attrs:{span:12}},[n("el-checkbox",{attrs:{label:t.key}}),n("div",{staticClass:"i-m-nem-tag-group"},[n("key-tags",{attrs:{size:"mini",addBtnVisible:!1,languages:e.languages,repositoryName:e.repositoryName,selectedTag:e.selectedTag,selectedKeyItem:t,keyInfo:e.keyInfosMap[t.key]},on:{"update:selectedTag":function(t){e.selectedTag=t},"update:selected-tag":function(t){e.selectedTag=t},"update:keyInfo":function(n){return e.$set(e.keyInfosMap,t.key,n)},"update:key-info":function(n){return e.$set(e.keyInfosMap,t.key,n)}}})],1)],1)})),1):e._e()],1)})),1):e._e()],1):n("div",{staticStyle:{"margin-top":"20px"}},[null!=e.renderedKeysListMap?n("el-checkbox-group",{staticClass:"i-m-nem-tags-checkbox-group clearfix",on:{change:e.onCheckedKeyListChange},model:{value:e.checkedKeyListArr[0],callback:function(t){e.$set(e.checkedKeyListArr,0,t)},expression:"checkedKeyListArr[0]"}},e._l(e.renderedKeysListMap[e.selectedModuleName],(function(t,a){return n("el-col",{key:t.key+a,attrs:{span:12}},[n("el-checkbox",{attrs:{label:t.key}}),n("div",{staticClass:"i-m-nem-tag-group"},[n("key-tags",{attrs:{size:"mini",addBtnVisible:!1,languages:e.languages,repositoryName:e.repositoryName,selectedTag:e.selectedTag,selectedKeyItem:t,keyInfo:e.keyInfosMap[t.key]},on:{"update:selectedTag":function(t){e.selectedTag=t},"update:selected-tag":function(t){e.selectedTag=t},"update:keyInfo":function(n){return e.$set(e.keyInfosMap,t.key,n)},"update:key-info":function(n){return e.$set(e.keyInfosMap,t.key,n)}}})],1)],1)})),1):e._e()],1)])},ke=[],we=(n("cb29"),{name:"tag-edit-mode",components:{KeyTags:ae},props:{languages:Array,repository:Object,allModuleData:Object},mixins:[H],data:function(){return{ALL_MODULES:N,allModuleLabel:"全部模块",selectedModuleName:N,selectedTag:"",searchInputStr:"",tagStr:"",renderedKeysMap:null,renderedKeysListMap:null,activeNames:[],checkedKeyListArr:[],targetCheckedKeyList:[],keyInfosMap:{}}},computed:{repositoryName:function(){return this.repository.repositoryName},reposModules:function(){return this.repository.directoryTree},reposModulesMap:function(){var e={};return this.repository.directoryTree.forEach((function(t){e[t.name]=t})),e}},methods:{init:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.reposModules.map((function(e){return e.name})),e.activeNames=n,e.clearCheckedKeyList(),e.refreshRenderedKeysListMap(),t.next=6,e.fetchAllKeyInfos();case 6:case"end":return t.stop()}}),t)})))()},clearCheckedKeyList:function(){var e=this.reposModules.length;this.checkedKeyListArr=new Array(e).fill([]),this.targetCheckedKeyList=[]},refreshRenderedKeysListMap:function(){var e=this.reposModules.map((function(e){return e.name}));this.renderedKeysListMap={},this.renderedKeysMap={};var t,n=Object(v["a"])(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=this.getModuleI18nData(this.allModuleData,this.repositoryName,a),s=this.getModuleI18nKeysList(a,r);s=this.formatKeysList(r,s),s=this.filterKeysList(s),this.renderedKeysListMap[a]=s,this.renderedKeysMap[a]=this.getKeysMap(s)}}catch(i){n.e(i)}finally{n.f()}},filterKeysList:function(e){var t=this,n=this.searchInputStr;return e.filter((function(e){var a=-1!==e.key.toLowerCase().indexOf(n);return t.languages.forEach((function(t){if(null!=e[t]){var r=e[t];Array.isArray(e[t])&&(r=e[t].join("")),a=a||-1!==r.toLowerCase().indexOf(n)}})),a}))},getKeysMap:function(e){var t,n={},a=Object(v["a"])(e);try{for(a.s();!(t=a.n()).done;){var r=t.value;n[r.key]=r}}catch(s){a.e(s)}finally{a.f()}return n},fetchAllKeyInfos:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,window.fetch("//i18n-ts.testfreelog.com/v1/i18nKeyInfos/all").then((function(e){return e.json()}));case 2:if(n=t.sent,e.keyInfosMap={},0===n.errcode){a=n.data,r=Object(v["a"])(a);try{for(r.s();!(s=r.n()).done;)i=s.value,o=i.name,e.keyInfosMap[o]=i}catch(c){r.e(c)}finally{r.f()}}case 5:case"end":return t.stop()}}),t)})))()},exchangeModuleName:function(e){this.checkedKeyListArr=N===e?new Array(this.reposModules.length).fill([]):new Array(1).fill([]),this.targetCheckedKeyList=[],this.selectedModuleName=e},onCheckedKeyListChange:function(){for(var e=[],t=this.checkedKeyListArr,n=t.length,a=0;a<n;a++){var r=t[a],s=this.getModuleName(a);console.log("moduleName -",s);var i,o=this.renderedKeysMap[s],c=Object(v["a"])(r);try{for(c.s();!(i=c.n()).done;){var l=i.value;if(o[l]){var u=this.resolveKeyInfo(o[l]);e.push(u)}}}catch(d){c.e(d)}finally{c.f()}}this.targetCheckedKeyList=e},getModuleName:function(e){return this.selectedModuleName===N?this.activeNames[e]:this.selectedModuleName},resolveKeyInfo:function(e){var t=this.repositoryName,n=e.moduleName,a=this.languages.map((function(t){return{lang:t,value:e[t]}}));return{repositoryName:t,moduleName:n,name:e.key,description:"",values:a}},refreshRenderedKeysList:function(){},batchAddTag:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n,a,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.tagStr.replace(/^(\s*)|(\s*)$/g,""),""!==n){t.next=4;break}return e.$message.warning("tag不能为空！"),t.abrupt("return");case 4:if(a=e.targetCheckedKeyList,0!==a.length){t.next=8;break}return e.$message.warning("您未选择key"),t.abrupt("return");case 8:return r={repositoryName:e.repositoryName,newTag:n,checkedKeyList:a},t.next=11,window.fetch("//i18n-ts.testfreelog.com/v1/i18nKeyInfos/tags",{method:"POST",body:r}).then((function(e){return e.json()}));case 11:if(s=t.sent,0!==s.errcode){t.next=18;break}return e.$message.success("tag添加成功！"),e.clearCheckedKeyList(),e.tagStr="",t.next=18,e.fetchAllKeyInfos();case 18:console.log("[targetArr]:",JSON.parse(JSON.stringify(a)));case 19:case"end":return t.stop()}}),t)})))()}},mounted:function(){this.init()}}),Ne=we,Se=(n("4364"),Object(p["a"])(Ne,Me,ke,!1,null,null,null)),Ke=Se.exports,Oe={},xe={name:"i18n-manament-home",components:{FileEditView:P,NamespaceEditView:be,TagsEditView:Ke,RepositoryPushBtn:_},mixins:[H],data:function(){return{mode:"namespace-edit",modes:[{id:"FileEditView",mode:"file-edit",label:"文件编辑模式",icon:"el-icon-files"},{id:"NamespaceEditView",mode:"namespace-edit",label:"Key编辑模式",icon:"el-icon-edit-outline"},{id:"TagsEditView",mode:"key-tags-edit",label:"Tags编辑",icon:"el-icon-edit"}],languages:[],trackedRepositories:[],selectedRepository:null,selectedReposName:"freelogfe-web-repos",allModuleData:null,selectedReposChanges:[],showUpdatePopover:!1,showEmptyCommitError:!1,commitMsg:"",isPushing:!1,showGithubOAuthBtn:!1,githubUser:null,loadingVisible:!1}},computed:{targetComponentId:function(){for(var e=this.modes.length,t=0;t<e;t++)if(this.mode===this.modes[t].mode)return this.modes[t].id;return""},githubOAuthUrl:function(){return"https://github.com/login/oauth/authorize?client_id=874c97335a3e4df726af&redirect_uri=".concat(encodeURIComponent(window.location.href))},reposCommitsUrl:function(){if(null!=this.selectedRepository){var e=this.selectedRepository,t=e.repositoryUrl,n=e.repositoryI18nBranch;return"".concat(t,"/commits/").concat(n)}return null!=this.selectedRepository?this.selectedRepository.repositoryUrl:""}},watch:{selectedReposName:function(){this.init()}},methods:{init:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loadingVisible=!0,t.prev=1,t.next=4,e.fetchTrackedRepositories();case 4:t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](1),console.log("fetchTrackedRepositories - Error:",t.t0);case 9:return t.prev=9,e.loadingVisible=!1,t.finish(9);case 12:case"end":return t.stop()}}),t,null,[[1,6,9,12]])})))()},fetchTrackedRepositories:function(){var e=this;return Object(a["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,window.fetch("http://i18n-ts.testfreelog.com/v1/trackedRepositories/list").then((function(e){return console.log(e),e.json()}));case 2:if(n=t.sent,console.log(n),0!==n.errcode||!n.data.length){t.next=8;break}return e.resolveTrackedRepositories(n.data),t.next=8,e.fetchAllModuleData(e.selectedReposName);case 8:case"end":return t.stop()}}),t)})))()},resolveTrackedRepositories:function(e){if(this.trackedRepositories=e,""!==this.selectedReposName){var t,n=Object(v["a"])(this.trackedRepositories);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.repositoryName===this.selectedReposName&&(this.selectedRepository=a)}}catch(r){n.e(r)}finally{n.f()}}else this.selectedRepository=this.trackedRepositories[0],this.selectedReposName=this.selectedRepository.repositoryName;this.selectedReposChanges=this.selectedRepository.repositoryChanges,this.getLanguages()},fetchAllModuleData:function(e){var t=this;return Object(a["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.abrupt("return",window.fetch("//i18n-ts.testfreelog.com/v1/i18nRepository/allData?repositoryName=".concat(e)).then((function(e){return e.json()})).then((function(e){if(console.log(e),0!==e.errcode)throw new Error(e.msg);t.allModuleData=e.data})).catch((function(e){return t.$error.showErrorMessage(e)})));case 1:case"end":return n.stop()}}),n)})))()},getLanguages:function(){if(null==this.selectedRepository)return[];var e,t=new Set,n=Object(v["a"])(this.selectedRepository.directoryTree);try{for(n.s();!(e=n.n()).done;){var a,r=e.value,s=Object(v["a"])(r.children);try{for(s.s();!(a=s.n()).done;){var i=a.value;t.add(i.name)}}catch(o){s.e(o)}finally{s.f()}}}catch(o){n.e(o)}finally{n.f()}this.languages=Object(y["a"])(t)},fetchJSONFileContent:function(e,t){var n=this;return Object(a["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!Oe[e]){a.next=4;break}return a.abrupt("return",Oe[e]);case 4:return a.next=6,window.fetch("//i18n-ts.testfreelog.com/v1/i18nRepository/data?targetPath=".concat(encodeURIComponent(e),"&pathType=1&repositoryName=").concat(n.selectedReposName)).then((function(e){return e.json()}));case 6:if(r=a.sent,0!==r.errcode){a.next=13;break}return s=M.a.get(r.data,t),Oe[e]=s,a.abrupt("return",s);case 13:return a.abrupt("return",null);case 14:case"end":return a.stop()}}),a)})))()},selectRepository:function(e){this.selectedReposName=e;var t,n=Object(v["a"])(this.trackedRepositories);try{for(n.s();!(t=n.n()).done;){var a=t.value;a.repositoryName===e&&(this.selectedRepository=a)}}catch(r){n.e(r)}finally{n.f()}},updateRepositoryChanges:function(e){this.selectedReposChanges=e},updateCacheJSONString:function(e){var t=e.path,n=e.value;Oe[t]=n},addModuleSuccess:function(e,t){this.resolveTrackedRepositories(t);var n,a=Object(v["a"])(this.languages);try{for(a.s();!(n=a.n()).done;){var r=n.value;M.a.set(this.allModuleData,[this.selectedReposName,e,r],{})}}catch(s){a.e(s)}finally{a.f()}},delModuleSuccess:function(e,t){this.resolveTrackedRepositories(t),M.a.del(this.allModuleData,[this.selectedReposName,e])}},mounted:function(){this.init()}},Ce=xe,_e=(n("c6c5"),n("67d1"),Object(p["a"])(Ce,f,g,!1,null,"9a86220c",null)),Ie=_e.exports;r["default"].use(o.a),r["default"].use(s["a"]);var Re=new s["a"]({scrollBehavior:function(e,t,n){return n||{x:0,y:0}},routes:[{path:"/",component:Ie}]}),je=null;function Le(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.container;je=new r["default"]({router:Re,render:function(e){return e(h)}}).$mount(t?t.querySelector("#app"):"#app")}function Te(e){e.onGlobalStateChange&&e.onGlobalStateChange((function(t,n){return console.log("[onGlobalStateChange - ".concat(e.name,"]:"),t,n)}),!0),e.setGlobalState&&e.setGlobalState({ignore:e.name,user:{name:e.name}})}function Ee(){return Je.apply(this,arguments)}function Je(){return Je=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("[vue] vue app bootstraped");case 1:case"end":return e.stop()}}),e)}))),Je.apply(this,arguments)}function $e(e){return De.apply(this,arguments)}function De(){return De=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("[vue] props from main framework",t),Te(t),Le(t);case 3:case"end":return e.stop()}}),e)}))),De.apply(this,arguments)}function Ve(){return Ae.apply(this,arguments)}function Ae(){return Ae=Object(a["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:je.$destroy(),je.$el.innerHTML="",je=null,Re=null;case 4:case"end":return e.stop()}}),e)}))),Ae.apply(this,arguments)}window.__POWERED_BY_FREELOG__||Le()},"589d":function(e,t,n){"use strict";n("c728")},"5b64":function(e,t,n){"use strict";n("02a8")},"67d1":function(e,t,n){"use strict";n("4aef")},"72a4":function(e,t,n){},"7fce":function(e,t,n){"use strict";n("c849")},"87fb":function(e,t,n){"use strict";n("72a4")},9983:function(e,t,n){},"9f51":function(e,t,n){"use strict";n("c7bc")},b9d8:function(e,t,n){},bd42:function(e,t,n){"use strict";n("d1ee")},c6c5:function(e,t,n){"use strict";n("13a3")},c728:function(e,t,n){},c7bc:function(e,t,n){},c849:function(e,t,n){},ca62:function(e,t,n){},d1ee:function(e,t,n){}})}));
//# sourceMappingURL=app.fdc025a9.js.map